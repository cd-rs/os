<!DOCTYPE html>
<html lang="en"><head>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-html/tabby.min.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/light-border.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-dark-707d8167ce6003fca903bfe2be84ab7f.css" rel="stylesheet" id="quarto-text-highlighting-styles"><meta charset="utf-8">
  <meta name="generator" content="quarto-1.8.25">

  <title>OS in Rust ‚Äì Bare Metal</title>
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">
  <link rel="stylesheet" href="site_libs/revealjs/dist/reset.css">
  <link rel="stylesheet" href="site_libs/revealjs/dist/reveal.css">
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      width: 0.8em;
      margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
      vertical-align: middle;
    }
    /* CSS for syntax highlighting */
    html { -webkit-text-size-adjust: 100%; }
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
      }
    pre.numberSource { margin-left: 3em;  padding-left: 4px; }
    div.sourceCode
      { color: #f8f8f2;  }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span { color: #f8f8f2; } /* Normal */
    code span.al { color: #f07178; } /* Alert */
    code span.an { color: #d4d0ab; } /* Annotation */
    code span.at { color: #00e0e0; } /* Attribute */
    code span.bn { color: #d4d0ab; } /* BaseN */
    code span.bu { color: #abe338; } /* BuiltIn */
    code span.cf { color: #ffa07a; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #abe338; } /* Char */
    code span.cn { color: #ffd700; } /* Constant */
    code span.co { color: #f8f8f2; font-style: italic; } /* Comment */
    code span.cv { color: #ffd700; } /* CommentVar */
    code span.do { color: #f8f8f2; } /* Documentation */
    code span.dt { color: #ffa07a; } /* DataType */
    code span.dv { color: #d4d0ab; } /* DecVal */
    code span.er { color: #f07178; text-decoration: underline; } /* Error */
    code span.ex { color: #00e0e0; font-weight: bold; } /* Extension */
    code span.fl { color: #d4d0ab; } /* Float */
    code span.fu { color: #ffa07a; } /* Function */
    code span.im { color: #abe338; } /* Import */
    code span.in { color: #d4d0ab; } /* Information */
    code span.kw { color: #ffa07a; font-weight: bold; } /* Keyword */
    code span.op { color: #ffa07a; } /* Operator */
    code span.ot { color: #00e0e0; } /* Other */
    code span.pp { color: #dcc6e0; } /* Preprocessor */
    code span.re { color: #00e0e0; background-color: #f8f8f2; } /* RegionMarker */
    code span.sc { color: #abe338; } /* SpecialChar */
    code span.ss { color: #abe338; } /* SpecialString */
    code span.st { color: #abe338; } /* String */
    code span.va { color: #00e0e0; } /* Variable */
    code span.vs { color: #abe338; } /* VerbatimString */
    code span.wa { color: #dcc6e0; } /* Warning */
  </style>
  <link rel="stylesheet" href="site_libs/revealjs/dist/theme/quarto-1d86d68c35eb7061f9efcb6a994936f6.css">
  <link href="site_libs/revealjs/plugin/quarto-line-highlight/line-highlight.css" rel="stylesheet">
  <link href="site_libs/revealjs/plugin/reveal-menu/menu.css" rel="stylesheet">
  <link href="site_libs/revealjs/plugin/reveal-menu/quarto-menu.css" rel="stylesheet">
  <link href="site_libs/revealjs/plugin/quarto-support/footer.css" rel="stylesheet">
  <style type="text/css">
    .reveal div.sourceCode {
      margin: 0;
      overflow: auto;
    }
    .reveal div.hanging-indent {
      margin-left: 1em;
      text-indent: -1em;
    }
    .reveal .slide:not(.center) {
      height: 100%;
    }
    .reveal .slide.scrollable {
      overflow-y: auto;
    }
    .reveal .footnotes {
      height: 100%;
      overflow-y: auto;
    }
    .reveal .slide .absolute {
      position: absolute;
      display: block;
    }
    .reveal .footnotes ol {
      counter-reset: ol;
      list-style-type: none; 
      margin-left: 0;
    }
    .reveal .footnotes ol li:before {
      counter-increment: ol;
      content: counter(ol) ". "; 
    }
    .reveal .footnotes ol li > p:first-child {
      display: inline-block;
    }
    .reveal .slide ul,
    .reveal .slide ol {
      margin-bottom: 0.5em;
    }
    .reveal .slide ul li,
    .reveal .slide ol li {
      margin-top: 0.4em;
      margin-bottom: 0.2em;
    }
    .reveal .slide ul[role="tablist"] li {
      margin-bottom: 0;
    }
    .reveal .slide ul li > *:first-child,
    .reveal .slide ol li > *:first-child {
      margin-block-start: 0;
    }
    .reveal .slide ul li > *:last-child,
    .reveal .slide ol li > *:last-child {
      margin-block-end: 0;
    }
    .reveal .slide .columns:nth-child(3) {
      margin-block-start: 0.8em;
    }
    .reveal blockquote {
      box-shadow: none;
    }
    .reveal .tippy-content>* {
      margin-top: 0.2em;
      margin-bottom: 0.7em;
    }
    .reveal .tippy-content>*:last-child {
      margin-bottom: 0.2em;
    }
    .reveal .slide > img.stretch.quarto-figure-center,
    .reveal .slide > img.r-stretch.quarto-figure-center {
      display: block;
      margin-left: auto;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-left,
    .reveal .slide > img.r-stretch.quarto-figure-left  {
      display: block;
      margin-left: 0;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-right,
    .reveal .slide > img.r-stretch.quarto-figure-right  {
      display: block;
      margin-left: auto;
      margin-right: 0; 
    }
  </style>
</head>
<body class="quarto-dark">
  <div class="reveal">
    <div class="slides">

<section id="title-slide" class="quarto-title-block center">
  <h1 class="title">Bare Metal</h1>
  <p class="subtitle">OS in Rust</p>

<div class="quarto-title-authors">
</div>

</section>
<section id="announcements" class="slide level2">
<h2>Announcements</h2>
<ul>
<li><strong>Action Items</strong>:
<ul>
<li><code>malloc</code> stands eternal
<ul>
<li>Possibly the coolest assignment ever</li>
<li>I‚Äôm glad you all love it</li>
</ul></li>
<li>Homework this week is more complicated but also more supported.
<ul>
<li>Prioritize <code>malloc</code> I think.</li>
</ul></li>
</ul></li>
</ul>
</section>
<section id="today" class="slide level2">
<h2>Today</h2>
<ul>
<li>Bare metal
<ul>
<li>Bare metal</li>
<li>Ranting about how cool this is</li>
<li>Simulation</li>
<li>Emulation</li>
</ul></li>
<li>A bare metal binary
<ul>
<li>Runtimes</li>
<li><code>std</code></li>
</ul></li>
</ul>
</section>
<section id="citations" class="slide level2">
<h2>Citations</h2>
<ul>
<li>Outright theft:
<ul>
<li><a href="https://google.github.io/comprehensive-rust/bare-metal.html">Welcome to Bare Metal Rust</a></li>
<li><a href="https://os.phil-opp.com/freestanding-rust-binary/">A Freestanding Rust Binary</a></li>
</ul></li>
</ul>
</section>
<section>
<section id="motivation" class="title-slide slide level1 center">
<h1>Motivation</h1>

</section>
<section id="throwback-thmonday" class="slide level2">
<h2>Throwback ThMonday</h2>
<ul>
<li>I did this in grad school.
<ul>
<li><a href="https://medium.com/@rz2285/simulating-c-program-on-bare-metal-or1200-af67e2886fb8">RTL Simulation of C-Program on Bare-metal OR1200</a></li>
</ul></li>
<li>My researcher (Juni) did this in ‚Äô22
<ul>
<li><a href="https://cd-public.github.io/research/students/aphrodite.pdf">Bare-Metal Programs on RISC-V</a></li>
</ul></li>
<li>I did this‚Ä¶ last week.
<ul>
<li><a href="https://vcd2df.github.io/pnsqc/#/demonstration">Slides including bare-metal execution in Verilog</a></li>
</ul></li>
</ul>
</section>
<section id="bare-metal" class="slide level2">
<h2>Bare Metal</h2>
<blockquote>
<p><a href="https://en.wikipedia.org/wiki/Bare_machine">A computer which has no operating system. The software executed by a bare machine, commonly called a ‚Äúbare metal program‚Äù or ‚Äúbare metal application‚Äù, is designed to interact directly with hardware. Bare machines are widely used in embedded systems, particularly in cases where resources are limited or high performance is required.</a></p>
</blockquote>
</section>
<section id="some-terms" class="slide level2">
<h2>Some Terms</h2>
<ul>
<li>Should introduce a few terms.
<ul>
<li>Not required for OS but useful to know.</li>
</ul></li>
<li>Terms
<ul>
<li>Simulation</li>
<li>Emulation</li>
<li>Cross-compilation</li>
<li>QEMU</li>
</ul></li>
</ul>
</section>
<section id="simulation" class="slide level2">
<h2>Simulation</h2>
<ul>
<li>Models a system‚Äôs behavior</li>
<li>Focuses on high-level results, not internal logic</li>
<li>‚ÄúClose enough‚Äù for performance or logic testing</li>
<li>Simulating hardware components in software</li>
<li>Faster but less precise</li>
</ul>
</section>
<section id="emulation" class="slide level2">
<h2>Emulation</h2>
<ul>
<li>Replicating exact internal behavior of hardware</li>
<li>Software acting as hardware (CPU, registers, memory)</li>
<li><strong>Accuracy vs.&nbsp;Speed</strong>:
<ul>
<li>Much slower than simulation‚Ä¶ unless?</li>
<li>Goal: Guest software doesn‚Äôt know it‚Äôs not on actual silicon</li>
</ul></li>
</ul>
</section>
<section id="example" class="slide level2">
<h2>Example</h2>
<ul>
<li><code>x86-64</code> - the Intel/AMD architecture common for Linux and Windows - supports a ‚Äúlong double‚Äù float with 80 bits of precision.</li>
<li><code>ARM64</code> - a competing formulation most popularized as ‚ÄúApple silicon‚Äù with the M1 - lacks long doubles.</li>
</ul>
</section>
<section id="context" class="slide level2">
<h2>Context</h2>
<ul>
<li>It is trivial to implement a float in software‚Ä¶
<ul>
<li><a href="https://cd-c89.github.io/rs/51_f16.html"><code>f16</code></a></li>
</ul></li>
<li>It is relatively not-trivial to implement <em>an architecture</em> in software, though possible.
<ul>
<li>Here‚Äôs the smallest example I know:</li>
<li><a href="https://github.com/YosysHQ/picorv32">PicoRV32</a></li>
</ul></li>
</ul>
</section>
<section id="cross-compiling" class="slide level2">
<h2>Cross-Compiling</h2>
<ul>
<li>Example:‚Äù compiling code <em>on</em> an x86 laptop <em>for</em> an ARM chip
<ul>
<li>Common in embedded applications (e.g.&nbsp;program a thermostat)</li>
</ul></li>
<li>Compiler runs on Host A, produces binary for Target B
<ul>
<li>Essential for ‚Äúbare metal‚Äù development</li>
<li>Transmit the binary over wires (the bus!) to another device‚Äôs memory.</li>
</ul></li>
</ul>
</section>
<section id="considerations" class="slide level2">
<h2>Considerations</h2>
<ul>
<li>We must:
<ul>
<li><strong>Target</strong> a specific architecture</li>
<li><strong>Link</strong> against specific hardware memory maps</li>
</ul></li>
<li>Somehow you also need the actual hardware, unless‚Ä¶</li>
</ul>
</section>
<section id="qemu" class="slide level2">
<h2>QEMU</h2>
<ul>
<li>I used this a lot in grad school; less now.
<ul>
<li>Supports both emulation and virtualization
<ul>
<li>Virtualization emulates a device rather than a binary.</li>
<li>Used in cloud; can be fast; huge research area.</li>
</ul></li>
</ul></li>
<li>Let‚Äôs us run bare metal binaries without physical chips (which would cost $)</li>
<li>Write locally <span class="math inline">\(\rightarrow\)</span> Cross-compile <span class="math inline">\(\rightarrow\)</span> Run in QEMU</li>
</ul>
</section></section>
<section>
<section id="binary" class="title-slide slide level1 center">
<h1>Binary</h1>

</section>
<section id="first-steps" class="slide level2">
<h2>First Steps</h2>
<ul>
<li>The first step in creating our own operating system kernel is to create a Rust executable that does not link the standard library.</li>
<li>This makes it possible to run Rust code on the ‚Äúbare metal‚Äù without an underlying operating system.</li>
</ul>
</section>
<section id="introduction" class="slide level2">
<h2>Introduction</h2>
<ul>
<li>To write an operating system kernel, we need code that does not depend on any operating system features.</li>
<li>This means that we can‚Äôt use files, the heap, networks, random numbers, standard output, etc.</li>
<li>We‚Äôre trying to write our own OS!</li>
</ul>
</section>
<section id="on-std" class="slide level2">
<h2>On <code>std</code></h2>
<ul>
<li>We can‚Äôt use most of the Rust standard library, but‚Ä¶</li>
<li>‚Ä¶there are a lot of Rust features that we <em>can</em> use.</li>
<li>For example, we can use iterators, closures, pattern matching, <code>option</code> and <code>result</code>
<ul>
<li>Recall the official Calvin Deutschbein position on <code>option</code> and <code>result</code>:</li>
<li>‚ÄúIt‚Äôs why Rust is good.‚Äù - me</li>
</ul></li>
</ul>
</section>
<section id="on-std-1" class="slide level2">
<h2>On <code>std</code></h2>
<ul>
<li>While not initially helpful, we can use string formatting, and‚Ä¶</li>
<li>‚Ä¶ the ownership system.
<ul>
<li>Beats <code>malloc</code>!</li>
</ul></li>
</ul>
</section>
<section id="quoth-the-blog" class="slide level2">
<h2>Quoth The Blog</h2>
<blockquote>
<p>These features make it possible to write a kernel in a very expressive, high level way without worrying about undefined behavior or memory safety.</p>
</blockquote>
<ul>
<li>Well, we‚Äôll see.</li>
</ul>
</section>
<section id="we-keep" class="slide level2 smaller">
<h2>We keep</h2>
<ul>
<li><a href="https://doc.rust-lang.org/core/option/">option</a></li>
<li><a href="https://doc.rust-lang.org/core/result/">result</a></li>
<li><a href="https://doc.rust-lang.org/std/">Rust standard library</a></li>
<li><a href="https://doc.rust-lang.org/book/ch13-02-iterators.html">iterators</a></li>
<li><a href="https://doc.rust-lang.org/book/ch13-01-closures.html">closures</a></li>
<li><a href="https://doc.rust-lang.org/book/ch06-00-enums.html">pattern matching</a></li>
<li><a href="https://doc.rust-lang.org/core/macro.write.html">string formatting</a></li>
<li><a href="https://doc.rust-lang.org/book/ch04-00-understanding-ownership.html">ownership system</a></li>
<li><a href="https://www.nayuki.io/page/undefined-behavior-in-c-and-cplusplus-programs">undefined behavior</a></li>
<li><a href="https://tonyarcieri.com/it-s-time-for-a-memory-safety-intervention">memory safety</a></li>
</ul>
</section>
<section id="onward" class="slide level2">
<h2>Onward!</h2>
<ul>
<li>We now enumerate the necessary steps to create a freestanding Rust binary‚Ä¶</li>
<li>‚Ä¶and explains why the steps are needed.</li>
</ul>
</section>
<section id="no_std" class="slide level2">
<h2><code>no_std</code></h2>
<ul>
<li>By default, all Rust crates link the standard library.
<ul>
<li>It depends on the operating system for features such as threads, files, or networking.</li>
<li>It also depends on the C standard library <code>libc</code>, which closely interacts with OS services.
<ul>
<li>That is, part of GNU but not part of Linux.</li>
</ul></li>
</ul></li>
</ul>
</section>
<section id="no_std-1" class="slide level2">
<h2><code>no_std</code></h2>
<ul>
<li>Since our plan is to write an operating system, we can‚Äôt use any OS-dependent libraries.
<ul>
<li>That would be recursive, which is only good sometimes!</li>
</ul></li>
<li>So we have to disable the automatic inclusion of the standard library through the <code>no_std</code> attribute.
<ul>
<li><a href="https://doc.rust-lang.org/std/">standard library</a></li>
<li><a href="https://doc.rust-lang.org/1.30.0/book/first-edition/using-rust-without-the-standard-library.html"><code>no_std</code> attribute</a></li>
</ul></li>
</ul>
</section>
<section id="to-begin" class="slide level2">
<h2>To begin</h2>
<ul>
<li>We can start creation the same way we make anything else in Rust‚Ä¶</li>
<li><em>Cargo</em> (sighs heavily)</li>
</ul>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb1"><pre class="sourceCode numberSource sh number-lines code-with-copy"><code class="sourceCode bash"><span id="cb1-1"><a></a><span class="ex">cargo</span> new <span class="pp">????</span> </span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="example-1" class="slide level2">
<h2>Example</h2>
<ul>
<li>Personally, I would expect you to maintain different OS versions with same crate name but within distinctly named directories (<code>32</code>,<code>42</code> etc.)</li>
</ul>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb2"><pre class="sourceCode numberSource sh number-lines code-with-copy"><code class="sourceCode bash"><span id="cb2-1"><a></a><span class="ex">cargo</span> new 32 <span class="at">--name</span> osirs <span class="at">--vcs</span> none</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="branches" class="slide level2">
<h2>Branches</h2>
<ul>
<li>A competing formulation would be to use <code>git branch</code> to create different developmental branches.</li>
<li>This is the industry standard and I wanted to introduce it but felt a time crunch.</li>
<li>If you are looking for something to do, figure it out.
<ul>
<li>Don‚Äôt worry about me finding things; its worth it to me for you to learn.</li>
</ul></li>
</ul>
</section>
<section id="name" class="slide level2">
<h2>Name</h2>
<div class="columns">
<div class="column" style="width:50%;">
<ul>
<li>You don‚Äôt have to name your OS anything in particular, I just thought <code>osirs</code> (OS in Rust) sounded heckin‚Äô rad.</li>
<li><a href="https://en.wikipedia.org/wiki/Osiris"> ô·¥è·¥° ·¥Ö·¥è·¥°…¥  ô·¥á“ì·¥è Ä·¥á ·¥õ ú·¥á …¢·¥è·¥Ö ·¥è“ì ·¥Ö·¥á·¥Ä·¥õ ú</a></li>
<li>Also a cringe AI real estate firm!</li>
</ul>
</div><div class="column" style="width:50%;">
<p><img data-src="https://upload.wikimedia.org/wikipedia/commons/thumb/8/8b/Standing_Osiris.svg/330px-Standing_Osiris.svg.png"></p>
</div></div>
</section>
<section id="refresh" class="slide level2">
<h2>Refresh</h2>
<ul>
<li>When we run the command, cargo creates the following directory structure for us:</li>
</ul>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb3"><pre class="sourceCode numberSource sh number-lines code-with-copy"><code class="sourceCode bash"><span id="cb3-1"><a></a><span class="ex">$</span> tree</span>
<span id="cb3-2"><a></a><span class="bu">.</span></span>
<span id="cb3-3"><a></a><span class="ex">‚îú‚îÄ‚îÄ</span> Cargo.toml</span>
<span id="cb3-4"><a></a><span class="ex">‚îî‚îÄ‚îÄ</span> src</span>
<span id="cb3-5"><a></a>    <span class="ex">‚îî‚îÄ‚îÄ</span> main.rs</span>
<span id="cb3-6"><a></a></span>
<span id="cb3-7"><a></a><span class="ex">1</span> directory, 2 files</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="recall" class="slide level2">
<h2>Recall</h2>
<ul>
<li><code>Cargo.toml</code> contains the crate configuration
<ul>
<li>Crate name</li>
<li>Crate author</li>
<li>Crate version</li>
</ul></li>
<li><code>src/main.rs</code> file contains our <code>main</code> function.</li>
<li>After <code>cargo build</code>, find the compiled <code>osirs</code> binary in the <code>target/debug</code> subfolder.</li>
</ul>
</section>
<section id="blah-blah-blah" class="slide level2">
<h2>Blah blah blah</h2>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb4"><pre class="sourceCode numberSource sh number-lines code-with-copy"><code class="sourceCode bash"><span id="cb4-1"><a></a><span class="ex">$</span> cargo build <span class="kw">;</span> <span class="ex">tree</span></span>
<span id="cb4-2"><a></a>   <span class="ex">Compiling</span> osirs v0.1.0 <span class="er">(</span><span class="ex">/home/user/tmp/32</span><span class="kw">)</span></span>
<span id="cb4-3"><a></a>    <span class="ex">Finished</span> <span class="kw">`</span><span class="ex">dev</span><span class="kw">`</span> profile [unoptimized + debuginfo] target<span class="er">(</span><span class="ex">s</span><span class="kw">)</span> <span class="er">in</span> <span class="ex">0.54s</span></span>
<span id="cb4-4"><a></a><span class="bu">.</span></span>
<span id="cb4-5"><a></a><span class="ex">‚îú‚îÄ‚îÄ</span> Cargo.lock</span>
<span id="cb4-6"><a></a><span class="ex">‚îú‚îÄ‚îÄ</span> Cargo.toml</span>
<span id="cb4-7"><a></a><span class="ex">‚îú‚îÄ‚îÄ</span> src</span>
<span id="cb4-8"><a></a><span class="ex">‚îÇ&nbsp;&nbsp;</span> ‚îî‚îÄ‚îÄ main.rs</span>
<span id="cb4-9"><a></a><span class="ex">‚îî‚îÄ‚îÄ</span> target</span>
<span id="cb4-10"><a></a>    <span class="ex">‚îú‚îÄ‚îÄ</span> CACHEDIR.TAG</span>
<span id="cb4-11"><a></a>    <span class="ex">‚îî‚îÄ‚îÄ</span> debug</span>
<span id="cb4-12"><a></a>        <span class="ex">‚îú‚îÄ‚îÄ</span> build</span>
<span id="cb4-13"><a></a>        <span class="ex">‚îú‚îÄ‚îÄ</span> deps</span>
<span id="cb4-14"><a></a>        <span class="ex">‚îÇ&nbsp;&nbsp;</span> ‚îú‚îÄ‚îÄ osirs-43412975b38d059d</span>
<span id="cb4-15"><a></a>        <span class="ex">‚îÇ&nbsp;&nbsp;</span> ‚îî‚îÄ‚îÄ osirs-43412975b38d059d.d</span>
<span id="cb4-16"><a></a>        <span class="ex">‚îú‚îÄ‚îÄ</span> examples</span>
<span id="cb4-17"><a></a>        <span class="ex">‚îú‚îÄ‚îÄ</span> incremental</span>
<span id="cb4-18"><a></a>        <span class="ex">‚îÇ&nbsp;&nbsp;</span> ‚îî‚îÄ‚îÄ osirs-3gae52yq1943v</span>
<span id="cb4-19"><a></a>        <span class="ex">‚îÇ&nbsp;&nbsp;</span>     ‚îú‚îÄ‚îÄ s-hfeunnoewq-0c8luu5-5dmhke08rl6h5l09ku3va3gkx</span>
<span id="cb4-20"><a></a>        <span class="ex">‚îÇ&nbsp;&nbsp;</span>     ‚îÇ&nbsp;&nbsp; ‚îú‚îÄ‚îÄ 1tq3ts5gahvv7j1hzrmfdrzi6.o</span>
<span id="cb4-21"><a></a>        <span class="ex">‚îÇ&nbsp;&nbsp;</span>     ‚îÇ&nbsp;&nbsp; ‚îú‚îÄ‚îÄ 6zk3flo890c0qhh6fykb6746g.o</span>
<span id="cb4-22"><a></a>        <span class="ex">‚îÇ&nbsp;&nbsp;</span>     ‚îÇ&nbsp;&nbsp; ‚îú‚îÄ‚îÄ 8z45o15v3gxm5hydv3o63x07l.o</span>
<span id="cb4-23"><a></a>        <span class="ex">‚îÇ&nbsp;&nbsp;</span>     ‚îÇ&nbsp;&nbsp; ‚îú‚îÄ‚îÄ 9itjtn00r7d8c6mknmav20oex.o</span>
<span id="cb4-24"><a></a>        <span class="ex">‚îÇ&nbsp;&nbsp;</span>     ‚îÇ&nbsp;&nbsp; ‚îú‚îÄ‚îÄ bh9pj42wzikjd1ilqutnjbrx7.o</span>
<span id="cb4-25"><a></a>        <span class="ex">‚îÇ&nbsp;&nbsp;</span>     ‚îÇ&nbsp;&nbsp; ‚îú‚îÄ‚îÄ dep-graph.bin</span>
<span id="cb4-26"><a></a>        <span class="ex">‚îÇ&nbsp;&nbsp;</span>     ‚îÇ&nbsp;&nbsp; ‚îú‚îÄ‚îÄ eymyqxruzdb24suchgzd8ygxb.o</span>
<span id="cb4-27"><a></a>        <span class="ex">‚îÇ&nbsp;&nbsp;</span>     ‚îÇ&nbsp;&nbsp; ‚îú‚îÄ‚îÄ query-cache.bin</span>
<span id="cb4-28"><a></a>        <span class="ex">‚îÇ&nbsp;&nbsp;</span>     ‚îÇ&nbsp;&nbsp; ‚îî‚îÄ‚îÄ work-products.bin</span>
<span id="cb4-29"><a></a>        <span class="ex">‚îÇ&nbsp;&nbsp;</span>     ‚îî‚îÄ‚îÄ s-hfeunnoewq-0c8luu5.lock</span>
<span id="cb4-30"><a></a>        <span class="ex">‚îú‚îÄ‚îÄ</span> osirs</span>
<span id="cb4-31"><a></a>        <span class="ex">‚îî‚îÄ‚îÄ</span> osirs.d</span>
<span id="cb4-32"><a></a></span>
<span id="cb4-33"><a></a><span class="ex">9</span> directories, 18 files</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="running" class="slide level2">
<h2>Running</h2>
<ul>
<li>Technically no one can stop you from using <code>cargo run</code> or even <code>cargo run --release</code></li>
<li>But you can also just <code>build</code> and then <em>directly</em> run the executable.</li>
</ul>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb5"><pre class="sourceCode numberSource sh number-lines code-with-copy"><code class="sourceCode bash"><span id="cb5-1"><a></a><span class="ex">$</span> ./target/debug/osirs</span>
<span id="cb5-2"><a></a><span class="ex">Hello,</span> world!</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="the-no_std-attribute" class="slide level2">
<h2>The <code>no_std</code> Attribute</h2>
<ul>
<li>Initially, the crate implicitly links the standard library.</li>
<li>We can prepend the <code>no_std</code> attribute to <code>src/main.rs</code> to get the version of Rust that builds character!</li>
</ul>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>src/main.rs</strong></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb6" data-filename="src/main.rs"><pre class="sourceCode numberSource rs number-lines code-with-copy"><code class="sourceCode rust"><span id="cb6-1"><a></a><span class="co">// main.rs</span></span>
<span id="cb6-2"><a></a></span>
<span id="cb6-3"><a></a><span class="at">#![</span>no_std<span class="at">]</span></span>
<span id="cb6-4"><a></a></span>
<span id="cb6-5"><a></a><span class="kw">fn</span> main() <span class="op">{</span></span>
<span id="cb6-6"><a></a>    <span class="pp">println!</span>(<span class="st">" ô·¥è·¥° ·¥Ö·¥è·¥°…¥  ô·¥á“ì·¥è Ä·¥á ·¥õ ú·¥á …¢·¥è·¥Ö ·¥è“ì ·¥Ö·¥á·¥Ä·¥õ ú"</span>)<span class="op">;</span></span>
<span id="cb6-7"><a></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="we-can-rebuild" class="slide level2">
<h2>We Can Rebuild</h2>
<ul>
<li>Actually we can‚Äôt.</li>
</ul>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb7"><pre class="sourceCode numberSource sh number-lines code-with-copy"><code class="sourceCode bash"><span id="cb7-1"><a></a><span class="ex">$</span> cargo build</span>
<span id="cb7-2"><a></a>   <span class="ex">Compiling</span> osirs v0.1.0 <span class="er">(</span><span class="ex">/home/user/tmp/32</span><span class="kw">)</span></span>
<span id="cb7-3"><a></a><span class="ex">error:</span> cannot find macro <span class="kw">`</span><span class="ex">println</span><span class="kw">`</span> in this scope</span>
<span id="cb7-4"><a></a> <span class="ex">--</span><span class="op">&gt;</span> src/main.rs:6:5</span>
<span id="cb7-5"><a></a>  <span class="kw">|</span></span>
<span id="cb7-6"><a></a><span class="ex">6</span> <span class="kw">|</span>     <span class="ex">println!</span><span class="er">(</span><span class="st">" ô·¥è·¥° ·¥Ö·¥è·¥°…¥  ô·¥á“ì·¥è Ä·¥á ·¥õ ú·¥á …¢·¥è·¥Ö ·¥è“ì ·¥Ö·¥á·¥Ä·¥õ ú"</span><span class="kw">);</span></span>
<span id="cb7-7"><a></a>  <span class="kw">|</span>     <span class="ex">^^^^^^^</span></span>
<span id="cb7-8"><a></a></span>
<span id="cb7-9"><a></a><span class="ex">error:</span> <span class="kw">`</span><span class="co">#[panic_handler]</span><span class="kw">`</span> function required, but not found</span>
<span id="cb7-10"><a></a></span>
<span id="cb7-11"><a></a><span class="ex">error:</span> unwinding panics are not supported without std</span>
<span id="cb7-12"><a></a>  <span class="kw">|</span></span>
<span id="cb7-13"><a></a>  <span class="ex">=</span> help: using nightly cargo, use <span class="at">-Zbuild-std</span> with panic=<span class="st">"abort"</span> to avoid unwinding</span>
<span id="cb7-14"><a></a>  <span class="ex">=</span> note: since the core library is usually precompiled with panic=<span class="st">"unwind"</span>, rebuilding your crate with panic=<span class="st">"abort"</span> may not be enough to fix the problem</span>
<span id="cb7-15"><a></a></span>
<span id="cb7-16"><a></a><span class="ex">error:</span> could not compile <span class="kw">`</span><span class="ex">osirs</span><span class="kw">`</span> <span class="er">(</span><span class="ex">bin</span> <span class="st">"osirs"</span><span class="kw">)</span> <span class="ex">due</span> to 3 previous errors    ^^^^^^^</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="enhance" class="slide level2">
<h2>Enhance!</h2>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb8"><pre class="sourceCode numberSource sh number-lines code-with-copy"><code class="sourceCode bash"><span id="cb8-1"><a></a><span class="ex">error:</span> cannot find macro <span class="kw">`</span><span class="ex">println</span><span class="kw">`</span> in this scope</span>
<span id="cb8-2"><a></a> <span class="ex">--</span><span class="op">&gt;</span> src/main.rs:6:5</span>
<span id="cb8-3"><a></a>  <span class="kw">|</span></span>
<span id="cb8-4"><a></a><span class="ex">6</span> <span class="kw">|</span>     <span class="ex">println!</span><span class="er">(</span><span class="st">" ô·¥è·¥° ·¥Ö·¥è·¥°…¥  ô·¥á“ì·¥è Ä·¥á ·¥õ ú·¥á …¢·¥è·¥Ö ·¥è“ì ·¥Ö·¥á·¥Ä·¥õ ú"</span><span class="kw">);</span></span>
<span id="cb8-5"><a></a>  <span class="kw">|</span>     <span class="ex">^^^^^^^</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<ul>
<li>Oh right, we can‚Äôt print without an OS.</li>
</ul>
</section>
<section id="background" class="slide level2">
<h2>Background</h2>
<ul>
<li>The <code>println</code> macro is part of the standard library <code>std</code>.</li>
<li>We said <code>no_std</code>.</li>
<li>So we can no longer print things.</li>
<li>I hope it is clear how this is character-building!</li>
<li>Read more:
<ul>
<li><a href="https://doc.rust-lang.org/std/macro.println.html"><code>println</code> macro</a></li>
<li><a href="https://en.wikipedia.org/wiki/Standard_streams#Standard_output_.28stdout.29">standard output</a></li>
</ul></li>
</ul>
</section>
<section id="rip-it" class="slide level2">
<h2>Rip it</h2>
<ul>
<li>Remove the printing and try again:</li>
</ul>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>src/main.rs</strong></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb9" data-filename="src/main.rs"><pre class="sourceCode numberSource rs number-lines code-with-copy"><code class="sourceCode rust"><span id="cb9-1"><a></a><span class="co">// main.rs</span></span>
<span id="cb9-2"><a></a></span>
<span id="cb9-3"><a></a><span class="at">#![</span>no_std<span class="at">]</span></span>
<span id="cb9-4"><a></a></span>
<span id="cb9-5"><a></a><span class="kw">fn</span> main() <span class="op">{</span></span>
<span id="cb9-6"><a></a>    <span class="co">// println!(" ô·¥è·¥° ·¥Ö·¥è·¥°…¥  ô·¥á“ì·¥è Ä·¥á ·¥õ ú·¥á …¢·¥è·¥Ö ·¥è“ì ·¥Ö·¥á·¥Ä·¥õ ú");</span></span>
<span id="cb9-7"><a></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="problems-remain" class="slide level2">
<h2>Problems remain</h2>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb10"><pre class="sourceCode numberSource sh number-lines code-with-copy"><code class="sourceCode bash"><span id="cb10-1"><a></a><span class="ex">$</span> cargo build</span>
<span id="cb10-2"><a></a>   <span class="ex">Compiling</span> osirs v0.1.0 <span class="er">(</span><span class="ex">/home/user/tmp/32</span><span class="kw">)</span></span>
<span id="cb10-3"><a></a><span class="ex">error:</span> <span class="kw">`</span><span class="co">#[panic_handler]</span><span class="kw">`</span> function required, but not found</span>
<span id="cb10-4"><a></a></span>
<span id="cb10-5"><a></a><span class="ex">error:</span> unwinding panics are not supported without std</span>
<span id="cb10-6"><a></a>  <span class="kw">|</span></span>
<span id="cb10-7"><a></a>  <span class="ex">=</span> help: using nightly cargo, use <span class="at">-Zbuild-std</span> with panic=<span class="st">"abort"</span> to avoid unwinding</span>
<span id="cb10-8"><a></a>  <span class="ex">=</span> note: since the core library is usually precompiled with panic=<span class="st">"unwind"</span>, rebuilding your crate with panic=<span class="st">"abort"</span> may not be enough to fix the problem</span>
<span id="cb10-9"><a></a></span>
<span id="cb10-10"><a></a><span class="ex">error:</span> could not compile <span class="kw">`</span><span class="ex">osirs</span><span class="kw">`</span> <span class="er">(</span><span class="ex">bin</span> <span class="st">"osirs"</span><span class="kw">)</span> <span class="ex">due</span> to 2 previous errors</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="enhance-1" class="slide level2">
<h2>Enhance!</h2>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb11"><pre class="sourceCode numberSource sh number-lines code-with-copy"><code class="sourceCode bash"><span id="cb11-1"><a></a><span class="ex">error:</span> cannot find macro <span class="kw">`</span><span class="ex">println</span><span class="kw">`</span> in this scope</span>
<span id="cb11-2"><a></a> <span class="ex">--</span><span class="op">&gt;</span> src/main.rs:6:5</span>
<span id="cb11-3"><a></a>  <span class="kw">|</span></span>
<span id="cb11-4"><a></a><span class="ex">6</span> <span class="kw">|</span>     <span class="ex">println!</span><span class="er">(</span><span class="st">" ô·¥è·¥° ·¥Ö·¥è·¥°…¥  ô·¥á“ì·¥è Ä·¥á ·¥õ ú·¥á …¢·¥è·¥Ö ·¥è“ì ·¥Ö·¥á·¥Ä·¥õ ú"</span><span class="kw">);</span></span>
<span id="cb11-5"><a></a>  <span class="kw">|</span>     <span class="ex">^^^^^^^</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<ul>
<li>Sometimes, Rust explodes and calls the OS (written in C!) for help.</li>
<li>It can‚Äôt do that without <code>std</code> and is sad üò≠</li>
</ul>
</section>
<section id="panic" class="slide level2">
<h2>Panic</h2>
<ul>
<li>The <code>panic_handler</code> attribute defines the function that the compiler should invoke when a panic occurs.</li>
<li><code>std</code> provides its own panic handler function, but in a <code>no_std</code> environment we need to define it ourselves:</li>
<li><a href="https://doc.rust-lang.org/stable/book/ch09-01-unrecoverable-errors-with-panic.html">panic</a></li>
</ul>
</section>
<section id="our-approach" class="slide level2">
<h2>Our Approach</h2>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>src/main.rs</strong></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb12" data-filename="src/main.rs"><pre class="sourceCode numberSource rs number-lines code-with-copy"><code class="sourceCode rust"><span id="cb12-1"><a></a><span class="co">// main.rs</span></span>
<span id="cb12-2"><a></a></span>
<span id="cb12-3"><a></a><span class="co">/// This function is called on panic.</span></span>
<span id="cb12-4"><a></a><span class="at">#[</span>panic_handler<span class="at">]</span></span>
<span id="cb12-5"><a></a><span class="at">#[</span>allow<span class="at">(</span>unconditional_recursion<span class="at">)]</span></span>
<span id="cb12-6"><a></a><span class="kw">fn</span> panic(info<span class="op">:</span> <span class="op">&amp;</span><span class="pp">core::panic::</span>PanicInfo) <span class="op">-&gt;</span> <span class="op">!</span> <span class="op">{</span></span>
<span id="cb12-7"><a></a>    panic(info)</span>
<span id="cb12-8"><a></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="panics" class="slide level2">
<h2>Panics</h2>
<ul>
<li>The <code>PanicInfo</code> parameter contains:
<ul>
<li><em>file</em> and <em>line</em> where the panic happened</li>
<li>panic message (e.g.&nbsp;<code>panic!("YOLO")</code></li>
</ul></li>
<li>The function should never return.
<ul>
<li>So it is marked as a ‚Äúdiverging function‚Äù</li>
<li>It returns the ‚Äúnever‚Äù type <code>!</code>.</li>
</ul></li>
<li>Not much we can do in this function for now, so just recurse to prevent a return.</li>
</ul>
</section>
<section id="read-more" class="slide level2">
<h2>Read more‚Ä¶</h2>
<ul>
<li>I had never heard of or used these but to me it was clear why they would have to exist in a type safe language.
<ul>
<li><a href="https://doc.rust-lang.org/nightly/core/panic/struct.PanicInfo.html">PanicInfo</a></li>
<li><a href="https://doc.rust-lang.org/1.30.0/book/first-edition/functions.html#diverging-functions">diverging function</a></li>
<li><a href="https://doc.rust-lang.org/nightly/std/primitive.never.html">‚Äúnever‚Äù type</a></li>
</ul></li>
</ul>
</section>
<section id="retry" class="slide level2">
<h2>Retry</h2>
<ul>
<li>I bet it works now!</li>
</ul>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb13"><pre class="sourceCode numberSource sh number-lines code-with-copy"><code class="sourceCode bash"><span id="cb13-1"><a></a><span class="ex">$</span> cargo build</span>
<span id="cb13-2"><a></a>   <span class="ex">Compiling</span> osirs v0.1.0 <span class="er">(</span><span class="ex">/home/user/tmp/32</span><span class="kw">)</span></span>
<span id="cb13-3"><a></a><span class="ex">error:</span> unwinding panics are not supported without std</span>
<span id="cb13-4"><a></a>  <span class="kw">|</span></span>
<span id="cb13-5"><a></a>  <span class="ex">=</span> help: using nightly cargo, use <span class="at">-Zbuild-std</span> with panic=<span class="st">"abort"</span> to avoid unwinding</span>
<span id="cb13-6"><a></a>  <span class="ex">=</span> note: since the core library is usually precompiled with panic=<span class="st">"unwind"</span>, rebuilding your crate with panic=<span class="st">"abort"</span> may not be enough to fix the problem</span>
<span id="cb13-7"><a></a></span>
<span id="cb13-8"><a></a><span class="ex">error:</span> could not compile <span class="kw">`</span><span class="ex">osirs</span><span class="kw">`</span> <span class="er">(</span><span class="ex">bin</span> <span class="st">"osirs"</span><span class="kw">)</span> <span class="ex">due</span> to 1 previous error</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<ul>
<li>They should make a version of the OS class that is easy.
<ul>
<li>(They did - this class)</li>
</ul></li>
</ul>
</section>
<section id="panic-abort" class="slide level2">
<h2>Panic abort</h2>
<div class="columns">
<div class="column" style="width:50%;">
<ul>
<li>Fun fact - back when I was an OS engineer slash rocket scientist my first launch was <a href="https://en.wikipedia.org/wiki/Pad_Abort-1">‚ÄúPA-1‚Äù for ‚ÄúPad Abort 1‚Äù</a>
<ul>
<li>Blew up a rocket on the launch pad to make sure it was safe for humans.</li>
</ul></li>
</ul>
</div><div class="column" style="width:50%;">
<p><img data-src="https://upload.wikimedia.org/wikipedia/commons/thumb/d/d6/450775main_wstf0510e04493_hires.jpg/330px-450775main_wstf0510e04493_hires.jpg"></p>
</div></div>
</section>
<section id="panic-abort-1" class="slide level2">
<h2>Panic abort</h2>
<ul>
<li>The use of the term ‚Äúabort‚Äù which in some nation-states is a hot-button political issue has come up from time-to-time in the discourse.</li>
<li><a href="https://www.theregister.com/2018/05/09/gnu_glic_abort_stallman/">Read more from 2018</a></li>
</ul>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb14"><pre class="sourceCode numberSource email number-lines code-with-copy"><code class="sourceCode email"><span id="cb14-1"><a></a></span>
<span id="cb14-2"><a></a>25.7.4 Aborting a Program</span>
<span id="cb14-3"><a></a></span>
<span id="cb14-4"><a></a>...</span>
<span id="cb14-5"><a></a></span>
<span id="cb14-6"><a></a>Future Change Warning: Proposed Federal censorship regulations may prohibit us from giving you information about the possibility of calling this function. We would be required to say that this is not an acceptable way of terminating a program.</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="quoth-stallman" class="slide level2">
<h2>Quoth Stallman</h2>
<blockquote>
<p>‚ÄúThe point of this joke is even more important now than it was when I first wrote it,‚Äù [Free Software Foundation president] Stallman wrote in a note posted to project mailing list, in reference to today‚Äôs political climate. ‚ÄúPlease do not remove it. GNU is not a purely technical project, so the fact that this is not strictly and grimly technical is not a reason to remove this.‚Äù</p>
</blockquote>
</section>
<section id="now-in-rust" class="slide level2">
<h2>Now in Rust</h2>
<ul>
<li>We can oppose fascism <em>and</em>
<ul>
<li>(looks into the history of NASA and Lockheed Martin)</li>
<li>(clears throat)</li>
<li>Moving on!<br>
</li>
</ul></li>
<li>We can abort programs‚Ä¶ <em>in Rust</em></li>
</ul>
</section>
<section id="how" class="slide level2">
<h2>How?</h2>
<ul>
<li>Read carefully:</li>
</ul>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb15"><pre class="sourceCode numberSource sh number-lines code-with-copy"><code class="sourceCode bash"><span id="cb15-1"><a></a><span class="ex">=</span> help: using nightly cargo, use <span class="at">-Zbuild-std</span> with panic=<span class="st">"abort"</span> to avoid unwinding</span>
<span id="cb15-2"><a></a><span class="ex">=</span> note: since the core library is usually precompiled with panic=<span class="st">"unwind"</span>, rebuilding your crate with panic=<span class="st">"abort"</span> may not be enough to fix the problem</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<ul>
<li>Geniuses will recognize <code>panic="abort"</code> syntax</li>
</ul>
</section>
<section id="toml" class="slide level2">
<h2>TOML</h2>
<ul>
<li>It‚Äôs <code>.toml</code></li>
</ul>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>Cargo.toml</strong></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb16" data-filename="Cargo.toml"><pre class="sourceCode numberSource toml number-lines code-with-copy"><code class="sourceCode toml"><span id="cb16-1"><a></a><span class="kw">[package]</span></span>
<span id="cb16-2"><a></a><span class="dt">name</span> <span class="op">=</span> <span class="st">"osirs"</span></span>
<span id="cb16-3"><a></a><span class="dt">version</span> <span class="op">=</span> <span class="st">"0.1.0"</span></span>
<span id="cb16-4"><a></a><span class="dt">edition</span> <span class="op">=</span> <span class="st">"2024"</span></span>
<span id="cb16-5"><a></a></span>
<span id="cb16-6"><a></a><span class="kw">[dependencies]</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="crate-options" class="slide level2">
<h2>Crate options</h2>
<ul>
<li>Nominally there are use cases for which unwinding is undesirable
<ul>
<li>My take: All cases.</li>
</ul></li>
<li>So Rust provides an option to ‚Äúabort on panic‚Äù instead.</li>
<li>Our reference materials claims this disables the generation of unwinding symbol information and thus considerably reduces binary size.
<ul>
<li>I could not verify this independently.</li>
</ul></li>
</ul>
</section>
<section id="update-cargo.toml" class="slide level2">
<h2>Update <code>Cargo.toml</code></h2>
<ul>
<li>Add the following:</li>
</ul>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>Cargo.toml</strong></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb17" data-filename="Cargo.toml" data-code-line-numbers="8-12"><pre class="sourceCode numberSource toml number-lines code-with-copy"><code class="sourceCode toml"><span id="cb17-1"><a></a><span class="kw">[package]</span></span>
<span id="cb17-2"><a></a><span class="dt">name</span> <span class="op">=</span> <span class="st">"osirs"</span></span>
<span id="cb17-3"><a></a><span class="dt">version</span> <span class="op">=</span> <span class="st">"0.1.0"</span></span>
<span id="cb17-4"><a></a><span class="dt">edition</span> <span class="op">=</span> <span class="st">"2024"</span></span>
<span id="cb17-5"><a></a></span>
<span id="cb17-6"><a></a><span class="kw">[dependencies]</span></span>
<span id="cb17-7"><a></a></span>
<span id="cb17-8"><a></a><span class="kw">[profile.dev]</span></span>
<span id="cb17-9"><a></a><span class="dt">panic</span> <span class="op">=</span> <span class="st">"abort"</span></span>
<span id="cb17-10"><a></a></span>
<span id="cb17-11"><a></a><span class="kw">[profile.release]</span></span>
<span id="cb17-12"><a></a><span class="dt">panic</span> <span class="op">=</span> <span class="st">"abort"</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="now" class="slide level2">
<h2>Now‚Ä¶</h2>
<ul>
<li><p>This sets the panic strategy to <code>abort</code> for both the <code>dev</code> profile (used for <code>cargo build</code>) and the <code>release</code> profile (used for <code>cargo build --release</code>).</p></li>
<li><p><a href="https://github.com/rust-lang/rust/pull/32900">abort on panic</a></p></li>
<li><p>I bet it will work now.</p></li>
</ul>
</section>
<section id="whoops" class="slide level2">
<h2>Whoops!</h2>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb18"><pre class="sourceCode numberSource sh number-lines code-with-copy"><code class="sourceCode bash"><span id="cb18-1"><a></a><span class="ex">$</span> cargo build</span>
<span id="cb18-2"><a></a>   <span class="ex">Compiling</span> osirs v0.1.0 <span class="er">(</span><span class="ex">/home/user/tmp/32</span><span class="kw">)</span></span>
<span id="cb18-3"><a></a><span class="ex">error:</span> using <span class="kw">`</span><span class="ex">fn</span> main<span class="kw">`</span> requires the standard library</span>
<span id="cb18-4"><a></a>  <span class="kw">|</span></span>
<span id="cb18-5"><a></a>  <span class="ex">=</span> help: use <span class="kw">`</span><span class="co">#![no_main]</span><span class="kw">`</span> to bypass the Rust generated entrypoint and declare a platform specific entrypoint yourself, usually with <span class="kw">`</span><span class="co">#[no_mangle]</span><span class="kw">`</span></span>
<span id="cb18-6"><a></a></span>
<span id="cb18-7"><a></a><span class="ex">error:</span> could not compile <span class="kw">`</span><span class="ex">osirs</span><span class="kw">`</span> <span class="er">(</span><span class="ex">bin</span> <span class="st">"osirs"</span><span class="kw">)</span> <span class="ex">due</span> to 1 previous error</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<ul>
<li>We don‚Äôt have and can‚Äôt use a <code>main</code>!</li>
</ul>
</section>
<section id="to-be-continued" class="slide level2">
<h2>To be continued</h2>
<ul>
<li>I am 99% sure we run out of time here‚Ä¶</li>
<li>And will continue with the lab on linker errors!</li>
</ul>


</section></section>
    </div>
  <div class="quarto-auto-generated-content" style="display: none;">
<div class="footer footer-default">
<p><a href="index.html">Home</a></p>
</div>
</div></div>

  <script>window.backupDefine = window.define; window.define = undefined;</script>
  <script src="site_libs/revealjs/dist/reveal.js"></script>
  <!-- reveal.js plugins -->
  <script src="site_libs/revealjs/plugin/quarto-line-highlight/line-highlight.js"></script>
  <script src="site_libs/revealjs/plugin/pdf-export/pdfexport.js"></script>
  <script src="site_libs/revealjs/plugin/reveal-menu/menu.js"></script>
  <script src="site_libs/revealjs/plugin/reveal-menu/quarto-menu.js"></script>
  <script src="site_libs/revealjs/plugin/quarto-support/support.js"></script>
  

  <script src="site_libs/revealjs/plugin/notes/notes.js"></script>
  <script src="site_libs/revealjs/plugin/search/search.js"></script>
  <script src="site_libs/revealjs/plugin/zoom/zoom.js"></script>
  <script src="site_libs/revealjs/plugin/math/math.js"></script>
  <script>window.define = window.backupDefine; window.backupDefine = undefined;</script>

  <script>

      // Full list of configuration options available at:
      // https://revealjs.com/config/
      Reveal.initialize({
'controlsAuto': true,
'previewLinksAuto': false,
'pdfSeparateFragments': false,
'autoAnimateEasing': "ease",
'autoAnimateDuration': 1,
'autoAnimateUnmatched': true,
'jumpToSlide': true,
'menu': {"side":"left","useTextContentForMissingTitles":true,"markers":false,"loadIcons":false,"custom":[{"title":"Tools","icon":"<i class=\"fas fa-gear\"></i>","content":"<ul class=\"slide-menu-items\">\n<li class=\"slide-tool-item active\" data-item=\"0\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.fullscreen(event)\"><kbd>f</kbd> Fullscreen</a></li>\n<li class=\"slide-tool-item\" data-item=\"1\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.speakerMode(event)\"><kbd>s</kbd> Speaker View</a></li>\n<li class=\"slide-tool-item\" data-item=\"2\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.overview(event)\"><kbd>o</kbd> Slide Overview</a></li>\n<li class=\"slide-tool-item\" data-item=\"3\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.togglePdfExport(event)\"><kbd>e</kbd> PDF Export Mode</a></li>\n<li class=\"slide-tool-item\" data-item=\"4\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.toggleScrollView(event)\"><kbd>r</kbd> Scroll View Mode</a></li>\n<li class=\"slide-tool-item\" data-item=\"5\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.keyboardHelp(event)\"><kbd>?</kbd> Keyboard Help</a></li>\n</ul>"}],"openButton":true},
'smaller': false,
 
        // Display controls in the bottom right corner
        controls: false,

        // Help the user learn the controls by providing hints, for example by
        // bouncing the down arrow when they first encounter a vertical slide
        controlsTutorial: false,

        // Determines where controls appear, "edges" or "bottom-right"
        controlsLayout: 'edges',

        // Visibility rule for backwards navigation arrows; "faded", "hidden"
        // or "visible"
        controlsBackArrows: 'faded',

        // Display a presentation progress bar
        progress: true,

        // Display the page number of the current slide
        slideNumber: 'c/t',

        // 'all', 'print', or 'speaker'
        showSlideNumber: 'all',

        // Add the current slide number to the URL hash so that reloading the
        // page/copying the URL will return you to the same slide
        hash: true,

        // Start with 1 for the hash rather than 0
        hashOneBasedIndex: false,

        // Flags if we should monitor the hash and change slides accordingly
        respondToHashChanges: true,

        // Push each slide change to the browser history
        history: true,

        // Enable keyboard shortcuts for navigation
        keyboard: true,

        // Enable the slide overview mode
        overview: true,

        // Disables the default reveal.js slide layout (scaling and centering)
        // so that you can use custom CSS layout
        disableLayout: false,

        // Vertical centering of slides
        center: false,

        // Enables touch navigation on devices with touch input
        touch: true,

        // Loop the presentation
        loop: false,

        // Change the presentation direction to be RTL
        rtl: false,

        // see https://revealjs.com/vertical-slides/#navigation-mode
        navigationMode: 'linear',

        // Randomizes the order of slides each time the presentation loads
        shuffle: false,

        // Turns fragments on and off globally
        fragments: true,

        // Flags whether to include the current fragment in the URL,
        // so that reloading brings you to the same fragment position
        fragmentInURL: false,

        // Flags if the presentation is running in an embedded mode,
        // i.e. contained within a limited portion of the screen
        embedded: false,

        // Flags if we should show a help overlay when the questionmark
        // key is pressed
        help: true,

        // Flags if it should be possible to pause the presentation (blackout)
        pause: true,

        // Flags if speaker notes should be visible to all viewers
        showNotes: false,

        // Global override for autoplaying embedded media (null/true/false)
        autoPlayMedia: null,

        // Global override for preloading lazy-loaded iframes (null/true/false)
        preloadIframes: null,

        // Number of milliseconds between automatically proceeding to the
        // next slide, disabled when set to 0, this value can be overwritten
        // by using a data-autoslide attribute on your slides
        autoSlide: 0,

        // Stop auto-sliding after user input
        autoSlideStoppable: true,

        // Use this method for navigation when auto-sliding
        autoSlideMethod: null,

        // Specify the average time in seconds that you think you will spend
        // presenting each slide. This is used to show a pacing timer in the
        // speaker view
        defaultTiming: null,

        // Enable slide navigation via mouse wheel
        mouseWheel: false,

        // The display mode that will be used to show slides
        display: 'block',

        // Hide cursor if inactive
        hideInactiveCursor: true,

        // Time before the cursor is hidden (in ms)
        hideCursorTime: 5000,

        // Opens links in an iframe preview overlay
        previewLinks: false,

        // Transition style (none/fade/slide/convex/concave/zoom)
        transition: 'none',

        // Transition speed (default/fast/slow)
        transitionSpeed: 'default',

        // Transition style for full page slide backgrounds
        // (none/fade/slide/convex/concave/zoom)
        backgroundTransition: 'none',

        // Number of slides away from the current that are visible
        viewDistance: 3,

        // Number of slides away from the current that are visible on mobile
        // devices. It is advisable to set this to a lower number than
        // viewDistance in order to save resources.
        mobileViewDistance: 2,

        // The "normal" size of the presentation, aspect ratio will be preserved
        // when the presentation is scaled to fit different resolutions. Can be
        // specified using percentage units.
        width: 1050,

        height: 700,

        // Factor of the display size that should remain empty around the content
        margin: 0.1,

        math: {
          mathjax: 'https://cdn.jsdelivr.net/npm/mathjax@2.7.9/MathJax.js',
          config: 'TeX-AMS_HTML-full',
          tex2jax: {
            inlineMath: [['\\(','\\)']],
            displayMath: [['\\[','\\]']],
            balanceBraces: true,
            processEscapes: false,
            processRefs: true,
            processEnvironments: true,
            preview: 'TeX',
            skipTags: ['script','noscript','style','textarea','pre','code'],
            ignoreClass: 'tex2jax_ignore',
            processClass: 'tex2jax_process'
          },
        },

        // reveal.js plugins
        plugins: [QuartoLineHighlight, PdfExport, RevealMenu, QuartoSupport,

          RevealMath,
          RevealNotes,
          RevealSearch,
          RevealZoom
        ]
      });
    </script>
    <script id="quarto-html-after-body" type="application/javascript">
      window.document.addEventListener("DOMContentLoaded", function (event) {
        const tabsets =  window.document.querySelectorAll(".panel-tabset-tabby")
        tabsets.forEach(function(tabset) {
          const tabby = new Tabby('#' + tabset.id);
        });
        const isCodeAnnotation = (el) => {
          for (const clz of el.classList) {
            if (clz.startsWith('code-annotation-')) {                     
              return true;
            }
          }
          return false;
        }
        const onCopySuccess = function(e) {
          // button target
          const button = e.trigger;
          // don't keep focus
          button.blur();
          // flash "checked"
          button.classList.add('code-copy-button-checked');
          var currentTitle = button.getAttribute("title");
          button.setAttribute("title", "Copied!");
          let tooltip;
          if (window.bootstrap) {
            button.setAttribute("data-bs-toggle", "tooltip");
            button.setAttribute("data-bs-placement", "left");
            button.setAttribute("data-bs-title", "Copied!");
            tooltip = new bootstrap.Tooltip(button, 
              { trigger: "manual", 
                customClass: "code-copy-button-tooltip",
                offset: [0, -8]});
            tooltip.show();    
          }
          setTimeout(function() {
            if (tooltip) {
              tooltip.hide();
              button.removeAttribute("data-bs-title");
              button.removeAttribute("data-bs-toggle");
              button.removeAttribute("data-bs-placement");
            }
            button.setAttribute("title", currentTitle);
            button.classList.remove('code-copy-button-checked');
          }, 1000);
          // clear code selection
          e.clearSelection();
        }
        const getTextToCopy = function(trigger) {
          const outerScaffold = trigger.parentElement.cloneNode(true);
          const codeEl = outerScaffold.querySelector('code');
          for (const childEl of codeEl.children) {
            if (isCodeAnnotation(childEl)) {
              childEl.remove();
            }
          }
          return codeEl.innerText;
        }
        const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
          text: getTextToCopy
        });
        clipboard.on('success', onCopySuccess);
        if (window.document.getElementById('quarto-embedded-source-code-modal')) {
          const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
            text: getTextToCopy,
            container: window.document.getElementById('quarto-embedded-source-code-modal')
          });
          clipboardModal.on('success', onCopySuccess);
        }
          var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
          var mailtoRegex = new RegExp(/^mailto:/);
            var filterRegex = new RegExp('/' + window.location.host + '/');
          var isInternal = (href) => {
              return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
          }
          // Inspect non-navigation links and adorn them if external
         var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
          for (var i=0; i<links.length; i++) {
            const link = links[i];
            if (!isInternal(link.href)) {
              // undo the damage that might have been done by quarto-nav.js in the case of
              // links that we want to consider external
              if (link.dataset.originalHref !== undefined) {
                link.href = link.dataset.originalHref;
              }
            }
          }
        function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
          const config = {
            allowHTML: true,
            maxWidth: 500,
            delay: 100,
            arrow: false,
            appendTo: function(el) {
                return el.closest('section.slide') || el.parentElement;
            },
            interactive: true,
            interactiveBorder: 10,
            theme: 'light-border',
            placement: 'bottom-start',
          };
          if (contentFn) {
            config.content = contentFn;
          }
          if (onTriggerFn) {
            config.onTrigger = onTriggerFn;
          }
          if (onUntriggerFn) {
            config.onUntrigger = onUntriggerFn;
          }
            config['offset'] = [0,0];
            config['maxWidth'] = 700;
          window.tippy(el, config); 
        }
        const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
        for (var i=0; i<noterefs.length; i++) {
          const ref = noterefs[i];
          tippyHover(ref, function() {
            // use id or data attribute instead here
            let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
            try { href = new URL(href).hash; } catch {}
            const id = href.replace(/^#\/?/, "");
            const note = window.document.getElementById(id);
            if (note) {
              return note.innerHTML;
            } else {
              return "";
            }
          });
        }
        const findCites = (el) => {
          const parentEl = el.parentElement;
          if (parentEl) {
            const cites = parentEl.dataset.cites;
            if (cites) {
              return {
                el,
                cites: cites.split(' ')
              };
            } else {
              return findCites(el.parentElement)
            }
          } else {
            return undefined;
          }
        };
        var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
        for (var i=0; i<bibliorefs.length; i++) {
          const ref = bibliorefs[i];
          const citeInfo = findCites(ref);
          if (citeInfo) {
            tippyHover(citeInfo.el, function() {
              var popup = window.document.createElement('div');
              citeInfo.cites.forEach(function(cite) {
                var citeDiv = window.document.createElement('div');
                citeDiv.classList.add('hanging-indent');
                citeDiv.classList.add('csl-entry');
                var biblioDiv = window.document.getElementById('ref-' + cite);
                if (biblioDiv) {
                  citeDiv.innerHTML = biblioDiv.innerHTML;
                }
                popup.appendChild(citeDiv);
              });
              return popup.innerHTML;
            });
          }
        }
      });
      </script>
    

</body></html>