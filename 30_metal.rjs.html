<!DOCTYPE html>
<html lang="en"><head>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-html/tabby.min.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/light-border.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-dark-a4a11d514c7d463668e07712114998e6.css" rel="stylesheet" id="quarto-text-highlighting-styles"><meta charset="utf-8">
  <meta name="generator" content="quarto-1.6.30">

  <title>OS in Rust ‚Äì Bare Metal</title>
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">
  <link rel="stylesheet" href="site_libs/revealjs/dist/reset.css">
  <link rel="stylesheet" href="site_libs/revealjs/dist/reveal.css">
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      width: 0.8em;
      margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
      vertical-align: middle;
    }
    /* CSS for syntax highlighting */
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
      }
    pre.numberSource { margin-left: 3em;  padding-left: 4px; }
    div.sourceCode
      { color: #f8f8f2;  }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span { color: #f8f8f2; } /* Normal */
    code span.al { color: #f07178; background-color: #2a0f15; font-weight: bold; } /* Alert */
    code span.an { color: #d4d0ab; } /* Annotation */
    code span.at { color: #00e0e0; } /* Attribute */
    code span.bn { color: #d4d0ab; } /* BaseN */
    code span.bu { color: #abe338; } /* BuiltIn */
    code span.cf { color: #ffa07a; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #abe338; } /* Char */
    code span.cn { color: #ffd700; } /* Constant */
    code span.co { color: #f8f8f2; font-style: italic; } /* Comment */
    code span.cv { color: #ffd700; } /* CommentVar */
    code span.do { color: #f8f8f2; } /* Documentation */
    code span.dt { color: #ffa07a; } /* DataType */
    code span.dv { color: #d4d0ab; } /* DecVal */
    code span.er { color: #f07178; text-decoration: underline; } /* Error */
    code span.ex { color: #00e0e0; font-weight: bold; } /* Extension */
    code span.fl { color: #d4d0ab; } /* Float */
    code span.fu { color: #ffa07a; } /* Function */
    code span.im { color: #abe338; } /* Import */
    code span.in { color: #d4d0ab; } /* Information */
    code span.kw { color: #ffa07a; font-weight: bold; } /* Keyword */
    code span.op { color: #ffa07a; } /* Operator */
    code span.ot { color: #00e0e0; } /* Other */
    code span.pp { color: #dcc6e0; } /* Preprocessor */
    code span.re { color: #00e0e0; background-color: #f8f8f2; } /* RegionMarker */
    code span.sc { color: #abe338; } /* SpecialChar */
    code span.ss { color: #abe338; } /* SpecialString */
    code span.st { color: #abe338; } /* String */
    code span.va { color: #00e0e0; } /* Variable */
    code span.vs { color: #abe338; } /* VerbatimString */
    code span.wa { color: #dcc6e0; } /* Warning */
  </style>
  <link rel="stylesheet" href="site_libs/revealjs/dist/theme/quarto-0f071606cd187ea9c4f27a73aca9ddf7.css">
  <link href="site_libs/revealjs/plugin/quarto-line-highlight/line-highlight.css" rel="stylesheet">
  <link href="site_libs/revealjs/plugin/reveal-menu/menu.css" rel="stylesheet">
  <link href="site_libs/revealjs/plugin/reveal-menu/quarto-menu.css" rel="stylesheet">
  <link href="site_libs/revealjs/plugin/quarto-support/footer.css" rel="stylesheet">
  <style type="text/css">

  .callout {
    margin-top: 1em;
    margin-bottom: 1em;  
    border-radius: .25rem;
  }

  .callout.callout-style-simple { 
    padding: 0em 0.5em;
    border-left: solid #acacac .3rem;
    border-right: solid 1px silver;
    border-top: solid 1px silver;
    border-bottom: solid 1px silver;
    display: flex;
  }

  .callout.callout-style-default {
    border-left: solid #acacac .3rem;
    border-right: solid 1px silver;
    border-top: solid 1px silver;
    border-bottom: solid 1px silver;
  }

  .callout .callout-body-container {
    flex-grow: 1;
  }

  .callout.callout-style-simple .callout-body {
    font-size: 1rem;
    font-weight: 400;
  }

  .callout.callout-style-default .callout-body {
    font-size: 0.9rem;
    font-weight: 400;
  }

  .callout.callout-titled.callout-style-simple .callout-body {
    margin-top: 0.2em;
  }

  .callout:not(.callout-titled) .callout-body {
      display: flex;
  }

  .callout:not(.no-icon).callout-titled.callout-style-simple .callout-content {
    padding-left: 1.6em;
  }

  .callout.callout-titled .callout-header {
    padding-top: 0.2em;
    margin-bottom: -0.2em;
  }

  .callout.callout-titled .callout-title  p {
    margin-top: 0.5em;
    margin-bottom: 0.5em;
  }
    
  .callout.callout-titled.callout-style-simple .callout-content  p {
    margin-top: 0;
  }

  .callout.callout-titled.callout-style-default .callout-content  p {
    margin-top: 0.7em;
  }

  .callout.callout-style-simple div.callout-title {
    border-bottom: none;
    font-size: .9rem;
    font-weight: 600;
    opacity: 75%;
  }

  .callout.callout-style-default  div.callout-title {
    border-bottom: none;
    font-weight: 600;
    opacity: 85%;
    font-size: 0.9rem;
    padding-left: 0.5em;
    padding-right: 0.5em;
  }

  .callout.callout-style-default div.callout-content {
    padding-left: 0.5em;
    padding-right: 0.5em;
  }

  .callout.callout-style-simple .callout-icon::before {
    height: 1rem;
    width: 1rem;
    display: inline-block;
    content: "";
    background-repeat: no-repeat;
    background-size: 1rem 1rem;
  }

  .callout.callout-style-default .callout-icon::before {
    height: 0.9rem;
    width: 0.9rem;
    display: inline-block;
    content: "";
    background-repeat: no-repeat;
    background-size: 0.9rem 0.9rem;
  }

  .callout-title {
    display: flex
  }
    
  .callout-icon::before {
    margin-top: 1rem;
    padding-right: .5rem;
  }

  .callout.no-icon::before {
    display: none !important;
  }

  .callout.callout-titled .callout-body > .callout-content > :last-child {
    padding-bottom: 0.5rem;
    margin-bottom: 0;
  }

  .callout.callout-titled .callout-icon::before {
    margin-top: .5rem;
    padding-right: .5rem;
  }

  .callout:not(.callout-titled) .callout-icon::before {
    margin-top: 1rem;
    padding-right: .5rem;
  }

  /* Callout Types */

  div.callout-note {
    border-left-color: #4582ec !important;
  }

  div.callout-note .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAAEU0lEQVRYCcVXTWhcVRQ+586kSUMMxkyaElstCto2SIhitS5Ek8xUKV2poatCcVHtUlFQk8mbaaziwpWgglJwVaquitBOfhQXFlqlzSJpFSpIYyXNjBNiTCck7x2/8/LeNDOZxDuEkgOXe++553zfefee+/OYLOXFk3+1LLrRdiO81yNqZ6K9cG0P3MeFaMIQjXssE8Z1JzLO9ls20MBZX7oG8w9GxB0goaPrW5aNMp1yOZIa7Wv6o2ykpLtmAPs/vrG14Z+6d4jpbSKuhdcSyq9wGMPXjonwmESXrriLzFGOdDBLB8Y6MNYBu0dRokSygMA/mrun8MGFN3behm6VVAwg4WR3i6FvYK1T7MHo9BK7ydH+1uurECoouk5MPRyVSBrBHMYwVobG2aOXM07sWrn5qgB60rc6mcwIDJtQrnrEr44kmy+UO9r0u9O5/YbkS9juQckLed3DyW2XV/qWBBB3ptvI8EUY3I9p/67OW+g967TNr3Sotn3IuVlfMLVnsBwH4fsnebJvyGm5GeIUA3jljERmrv49SizPYuq+z7c2H/jlGC+Ghhupn/hcapqmcudB9jwJ/3jvnvu6vu5lVzF1fXyZuZZ7U8nRmVzytvT+H3kilYvH09mLWrQdwFSsFEsxFVs5fK7A0g8gMZjbif4ACpKbjv7gNGaD8bUrlk8x+KRflttr22JEMRUbTUwwDQScyzPgedQHZT0xnx7ujw2jfVfExwYHwOsDTjLdJ2ebmeQIlJ7neo41s/DrsL3kl+W2lWvAga0tR3zueGr6GL78M3ifH0rGXrBC2aAR8uYcIA5gwV8zIE8onoh8u0Fca/ciF7j1uOzEnqcIm59sEXoGc0+z6+H45V1CvAvHcD7THztu669cnp+L0okAeIc6zjbM/24LgGM1gZk7jnRu1aQWoU9sfUOuhrmtaPIO3YY1KLLWZaEO5TKUbMY5zx8W9UJ6elpLwKXbsaZ4EFl7B4bMtDv0iRipKoDQT2sNQI9b1utXFdYisi+wzZ/ri/1m7QfDgEuvgUUEIJPq3DhX/5DWNqIXDOweC2wvIR90Oq3lDpdMIgD2r0dXvGdsEW5H6x6HLRJYU7C69VefO1x8Gde1ZFSJLfWS1jbCnhtOPxmpfv2LXOA2Xk2tvnwKKPFuZ/oRmwBwqRQDcKNeVQkYcOjtWVBuM/JuYw5b6isojIkYxyYAFn5K7ZBF10fea52y8QltAg6jnMqNHFBmGkQ1j+U43HMi2xMar1Nv0zGsf1s8nUsmUtPOOrbFIR8bHFDMB5zL13Gmr/kGlCkUzedTzzmzsaJXhYawnA3UmARpiYj5ooJZiUoxFRtK3X6pgNPv+IZVPcnwbOl6f+aBaO1CNvPW9n9LmCp01nuSaTRF2YxHqZ8DYQT6WsXT+RD6eUztwYLZ8rM+rcPxamv1VQzFUkzFXvkiVrySGQgJNvXHJAxiU3/NwiC03rSf05VBaPtu/Z7/B8Yn/w7eguloAAAAAElFTkSuQmCC');
  }

  div.callout-note.callout-style-default .callout-title {
    background-color: #dae6fb
  }

  div.callout-important {
    border-left-color: #d9534f !important;
  }

  div.callout-important .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAAEKklEQVRYCcVXTWhcVRS+575MJym48A+hSRFr00ySRQhURRfd2HYjk2SSTokuBCkU2o0LoSKKraKIBTcuFCoidGFD08nkBzdREbpQ1EDNIv8qSGMFUboImMSZd4/f9zJv8ibJMC8xJQfO3HPPPef7zrvvvnvviIkpC9nsw0UttFunbUhpFzFtarSd6WJkStVMw5xyVqYTvkwfzuf/5FgtkVoB0729j1rjXwThS7Vio+Mo6DNnvLfahoZ+i/o32lULuJ3NNiz7q6+pyAUkJaFF6JwaM2lUJlV0MlnQn5aTRbEu0SEqHUa0A4AdiGuB1kFXRfVyg5d87+Dg4DL6m2TLAub60ilj7A1Ec4odSAc8X95sHh7+ZRPCFo6Fnp7HfU/fBng/hi10CjCnWnJjsxvDNxWw0NfV6Rv5GgP3I3jGWXumdTD/3cbEOP2ZbOZp69yniG3FQ9z1jD7bnBu9Fc2tKGC2q+uAJOQHBDRiZX1x36o7fWBs7J9ownbtO+n0/qWkvW7UPIfc37WgT6ZGR++EOJyeQDSb9UB+DZ1G6DdLDzyS+b/kBCYGsYgJbSQHuThGKRcw5xdeQf8YdNHsc6ePXrlSYMBuSIAFTGAtQo+VuALo4BX83N190NWZWbynBjhOHsmNfFWLeL6v+ynsA58zDvvAC8j5PkbOcXCMg2PZFk3q8MjI7WAG/Dp9AwP7jdGBOOQkAvlFUB+irtm16I1Zw9YBcpGTGXYmk3kQIC/Cds55l+iMI3jqhjAuaoe+am2Jw5GT3Nbz3CkE12NavmzN5+erJW7046n/CH1RO/RVa8lBLozXk9uqykkGAyRXLWlLv5jyp4RFsG5vGVzpDLnIjTWgnRy2Rr+tDKvRc7Y8AyZq10jj8DqXdnIRNtFZb+t/ZRtXcDiVnzpqx8mPcDWxgARUqx0W1QB9MeUZiNrV4qP+Ehc+BpNgATsTX8ozYKL2NtFYAHc84fG7ndxUPr+AR/iQSns7uSUufAymwDOb2+NjK27lEFocm/EE2WpyIy/Hi66MWuMKJn8RvxIcj87IM5Vh9663ziW36kR0HNenXuxmfaD8JC7tfKbrhFr7LiZCrMjrzTeGx+PmkosrkNzW94ObzwocJ7A1HokLolY+AvkTiD/q1H0cN48c5EL8Crkttsa/AXQVDmutfyku0E7jShx49XqV3MFK8IryDhYVbj7Sj2P2eBxwcXoe8T8idsKKPRcnZw1b+slFTubwUwhktrfnAt7J++jwQtLZcm3sr9LQrjRzz6cfMv9aLvgmnAGvpoaGLxM4mAEaLV7iAzQ3oU0IvD5x9ix3yF2RAAuYAOO2f7PEFWCXZ4C9Pb2UsgDeVnFSpbFK7/IWu7TPTvBqzbGdCHOJQSxiEjt6IyZmxQyEJHv6xyQsYk//moVFsN2zP6fRImjfq7/n/wFDguUQFNEwugAAAABJRU5ErkJggg==');
  }

  div.callout-important.callout-style-default .callout-title {
    background-color: #f7dddc
  }

  div.callout-warning {
    border-left-color: #f0ad4e !important;
  }

  div.callout-warning .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAAETklEQVRYCeVWW2gcVRg+58yaTUnizqbipZeX4uWhBEniBaoUX1Ioze52t7sRq6APio9V9MEaoWlVsFasRq0gltaAPuxms8lu0gcviE/FFOstVbSIxgcv6SU7EZqmdc7v9+9mJtNks51NTUH84ed889/PP+cmxP+d5FIbMJmNbpREu4WUkiTtCicKny0l1pIKmBzovF2S+hIJHX8iEu3hZJ5lNZGqyRrGSIQpq15AzF28jgpeY6yk6GVdrfFqdrD6Iw+QlB8g0YS2g7dyQmXM/IDhBhT0UCiRf59lfqmmDvzRt6kByV/m4JjtzuaujMUM2c5Z2d6JdKrRb3K2q6mA+oYVz8JnDdKPmmNthzkAk/lN63sYPgevrguc72aZX/L9C6x09GYyxBgCX4NlvyGUHOKELlm5rXeR1kchuChJt4SSwyddZRXgvwMGvYo4QSlk3/zkHD8UHxwVJA6zjZZqP8v8kK8OWLnIZtLyCAJagYC4rTGW/9Pqj92N/c+LUaAj27movwbi19tk/whRCIE7Q9vyI6yvRpftAKVTdUjOW40X3h5OXsKCdmFcx0xlLJoSuQngnrJe7Kcjm4OMq9FlC7CMmScQANuNvjfP3PjGXDBaUQmbp296S5L4DrpbrHN1T87ZVEZVCzg1FF0Ft+dKrlLukI+/c9ENo+TvlTDbYFvuKPtQ9+l052rXrgKoWkDAFnvh0wTOmYn8R5f4k/jN/fZiCM1tQx9jQQ4ANhqG4hiL0qIFTGViG9DKB7GYzgubnpofgYRwO+DFjh0Zin2m4b/97EDkXkc+f6xYAPX0KK2I/7fUQuwzuwo/L3AkcjugPNixC8cHf0FyPjWlItmLxWw4Ou9YsQCr5fijMGoD/zpdRy95HRysyXA74MWOnscpO4j2y3HAVisw85hX5+AFBRSHt4ShfLFkIMXTqyKFc46xdzQM6XbAi702a7sy04J0+feReMFKp5q9esYLCqAZYw/k14E/xcLLsFElaornTuJB0svMuJINy8xkIYuL+xPAlWRceH6+HX7THJ0djLUom46zREu7tTkxwmf/FdOZ/sh6Q8qvEAiHpm4PJ4a/doJe0gH1t+aHRgCzOvBvJedEK5OFE5jpm4AGP2a8Dxe3gGJ/pAutug9Gp6he92CsSsWBaEcxGx0FHytmIpuqGkOpldqNYQK8cSoXvd+xLxXADw0kf6UkJNFtdo5MOgaLjiQOQHcn+A6h5NuL2s0qsC2LOM75PcF3yr5STuBSAcGG+meA14K/CI21HcS4LBT6tv0QAh8Dr5l93AhZzG5ZJ4VxAqdZUEl9z7WJ4aN+svMvwHHL21UKTd1mqvChH7/Za5xzXBBKrUcB0TQ+Ulgkfbi/H/YT5EptrGzsEK7tR1B7ln9BBwckYfMiuSqklSznIuoIIOM42MQO+QnduCoFCI0bpkzjCjddHPN/F+2Yu+sd9bKNpVwHhbS3LluK/0zgfwD0xYI5dXuzlQAAAABJRU5ErkJggg==');
  }

  div.callout-warning.callout-style-default .callout-title {
    background-color: #fcefdc
  }

  div.callout-tip {
    border-left-color: #02b875 !important;
  }

  div.callout-tip .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAADr0lEQVRYCe1XTWgTQRj9ZjZV8a9SPIkKgj8I1bMHsUWrqYLVg4Ue6v9BwZOxSYsIerFao7UiUryIqJcqgtpimhbBXoSCVxUFe9CTiogUrUp2Pt+3aUI2u5vdNh4dmMzOzHvvezuz8xNFM0mjnbXaNu1MvFWRXkXEyE6aYOYJpdW4IXuA4r0fo8qqSMDBU0v1HJUgVieAXxzCsdE/YJTdFcVIZQNMyhruOMJKXYFoLfIfIvVIMWdsrd+Rpd86ZmyzzjJmLStqRn0v8lzkb4rVIXvnpScOJuAn2ACC65FkPzEdEy4TPWRLJ2h7z4cArXzzaOdKlbOvKKX25Wl00jSnrwVxAg3o4dRxhO13RBSdNvH0xSARv3adTXbBdTf64IWO2vH0LT+cv4GR1DJt+DUItaQogeBX/chhbTBxEiZ6gftlDNXTrvT7co4ub5A6gp9HIcHvzTa46OS5fBeP87Qm0fQkr4FsYgVQ7Qg+ZayaDg9jhg1GkWj8RG6lkeSacrrHgDaxdoBiZPg+NXV/KifMuB6//JmYH4CntVEHy/keA6x4h4CU5oFy8GzrBS18cLJMXcljAKB6INjWsRcuZBWVaS3GDrqB7rdapVIeA+isQ57Eev9eCqzqOa81CY05VLd6SamW2wA2H3SiTbnbSxmzfp7WtKZkqy4mdyAlGx7ennghYf8voqp9cLSgKdqNfa6RdRsAAkPwRuJZNbpByn+RrJi1RXTwdi8RQF6ymDwGMAtZ6TVE+4uoKh+MYkcLsT0Hk8eAienbiGdjJHZTpmNjlbFJNKDVAp2fJlYju6IreQxQ08UJDNYdoLSl6AadO+fFuCQqVMB1NJwPm69T04Wv5WhfcWyfXQB+wXRs1pt+nCknRa0LVzSA/2B+a9+zQJadb7IyyV24YAxKp2Jqs3emZTuNnKxsah+uabKbMk7CbTgJx/zIgQYErIeTKRQ9yD9wxVof5YolPHqaWo7TD6tJlh7jQnK5z2n3+fGdggIOx2kaa2YI9QWarc5Ce1ipNWMKeSG4DysFF52KBmTNMmn5HqCFkwy34rDg05gDwgH3bBi+sgFhN/e8QvRn8kbamCOhgrZ9GJhFDgfcMHzFb6BAtjKpFhzTjwv1KCVuxHvCbsSiEz4CANnj84cwHdFXAbAOJ4LTSAawGWFn5tDhLMYz6nWeU2wJfIhmIJBefcd/A5FWQWGgrWzyORZ3Q6HuV+Jf0Bj+BTX69fm1zWgK7By1YTXchFDORywnfQ7GpzOo6S+qECrsx2ifVQAAAABJRU5ErkJggg==');
  }

  div.callout-tip.callout-style-default .callout-title {
    background-color: #ccf1e3
  }

  div.callout-caution {
    border-left-color: #fd7e14 !important;
  }

  div.callout-caution .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAACV0lEQVRYCdVWzWoUQRCuqp2ICBLJXgITZL1EfQDBW/bkzUMUD7klD+ATSHBEfAIfQO+iXsWDxJsHL96EHAwhgzlkg8nBg25XWb0zIb0zs9muYYWkoKeru+vn664fBqElyZNuyh167NXJ8Ut8McjbmEraKHkd7uAnAFku+VWdb3reSmRV8PKSLfZ0Gjn3a6Xlcq9YGb6tADjn+lUfTXtVmaZ1KwBIvFI11rRXlWlatwIAAv2asaa9mlB9wwygiDX26qaw1yYPzFXg2N1GgG0FMF8Oj+VIx7E/03lHx8UhvYyNZLN7BwSPgekXXLribw7w5/c8EF+DBK5idvDVYtEEwMeYefjjLAdEyQ3M9nfOkgnPTEkYU+sxMq0BxNR6jExrAI31H1rzvLEfRIdgcv1XEdj6QTQAS2wtstEALLG1yEZ3QhH6oDX7ExBSFEkFINXH98NTrme5IOaaA7kIfiu2L8A3qhH9zRbukdCqdsA98TdElyeMe5BI8Rs2xHRIsoTSSVFfCFCWGPn9XHb4cdobRIWABNf0add9jakDjQJpJ1bTXOJXnnRXHRf+dNL1ZV1MBRCXhMbaHqGI1JkKIL7+i8uffuP6wVQAzO7+qVEbF6NbS0LJureYcWXUUhH66nLR5rYmva+2tjRFtojkM2aD76HEGAD3tPtKM309FJg5j/K682ywcWJ3PASCcycH/22u+Bh7Aa0ehM2Fu4z0SAE81HF9RkB21c5bEn4Dzw+/qNOyXr3DCTQDMBOdhi4nAgiFDGCinIa2owCEChUwD8qzd03PG+qdW/4fDzjUMcE1ZpIAAAAASUVORK5CYII=');
  }

  div.callout-caution.callout-style-default .callout-title {
    background-color: #ffe5d0
  }

  </style>
  <style type="text/css">
    .reveal div.sourceCode {
      margin: 0;
      overflow: auto;
    }
    .reveal div.hanging-indent {
      margin-left: 1em;
      text-indent: -1em;
    }
    .reveal .slide:not(.center) {
      height: 100%;
    }
    .reveal .slide.scrollable {
      overflow-y: auto;
    }
    .reveal .footnotes {
      height: 100%;
      overflow-y: auto;
    }
    .reveal .slide .absolute {
      position: absolute;
      display: block;
    }
    .reveal .footnotes ol {
      counter-reset: ol;
      list-style-type: none; 
      margin-left: 0;
    }
    .reveal .footnotes ol li:before {
      counter-increment: ol;
      content: counter(ol) ". "; 
    }
    .reveal .footnotes ol li > p:first-child {
      display: inline-block;
    }
    .reveal .slide ul,
    .reveal .slide ol {
      margin-bottom: 0.5em;
    }
    .reveal .slide ul li,
    .reveal .slide ol li {
      margin-top: 0.4em;
      margin-bottom: 0.2em;
    }
    .reveal .slide ul[role="tablist"] li {
      margin-bottom: 0;
    }
    .reveal .slide ul li > *:first-child,
    .reveal .slide ol li > *:first-child {
      margin-block-start: 0;
    }
    .reveal .slide ul li > *:last-child,
    .reveal .slide ol li > *:last-child {
      margin-block-end: 0;
    }
    .reveal .slide .columns:nth-child(3) {
      margin-block-start: 0.8em;
    }
    .reveal blockquote {
      box-shadow: none;
    }
    .reveal .tippy-content>* {
      margin-top: 0.2em;
      margin-bottom: 0.7em;
    }
    .reveal .tippy-content>*:last-child {
      margin-bottom: 0.2em;
    }
    .reveal .slide > img.stretch.quarto-figure-center,
    .reveal .slide > img.r-stretch.quarto-figure-center {
      display: block;
      margin-left: auto;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-left,
    .reveal .slide > img.r-stretch.quarto-figure-left  {
      display: block;
      margin-left: 0;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-right,
    .reveal .slide > img.r-stretch.quarto-figure-right  {
      display: block;
      margin-left: auto;
      margin-right: 0; 
    }
  </style>
</head>
<body class="quarto-dark">
  <div class="reveal">
    <div class="slides">

<section id="title-slide" class="quarto-title-block center">
  <h1 class="title">Bare Metal</h1>
  <p class="subtitle">OS in Rust</p>

<div class="quarto-title-authors">
</div>

</section>
<section id="announcements" class="slide level2">
<h2>Announcements</h2>
<ul>
<li><strong>Action Items</strong>:
<ul>
<li><code>malloc</code> stands eternal
<ul>
<li>Possibly the coolest assignment ever</li>
<li>I‚Äôm glad you all love it</li>
</ul></li>
<li>Homework this week is more complicated but also more supported.
<ul>
<li>Prioritize <code>malloc</code> I think.</li>
</ul></li>
</ul></li>
</ul>
</section>
<section id="today" class="slide level2">
<h2>Today</h2>
<ul>
<li>Bare metal
<ul>
<li>Bare metal</li>
<li>Ranting about how cool this is</li>
<li>Simulation</li>
<li>Emulation</li>
</ul></li>
<li>A bare metal binary
<ul>
<li>Runtimes</li>
<li><code>std</code></li>
</ul></li>
</ul>
</section>
<section id="citations" class="slide level2">
<h2>Citations</h2>
<ul>
<li>Outright theft:
<ul>
<li><a href="https://google.github.io/comprehensive-rust/bare-metal.html">Welcome to Bare Metal Rust</a></li>
<li><a href="https://os.phil-opp.com/freestanding-rust-binary/">A Freestanding Rust Binary</a></li>
</ul></li>
</ul>
</section>
<section>
<section id="motivation" class="title-slide slide level1 center">
<h1>Motivation</h1>

</section>
<section id="throwback-thmonday" class="slide level2">
<h2>Throwback ThMonday</h2>
<ul>
<li>I did this in grad school.
<ul>
<li><a href="https://medium.com/@rz2285/simulating-c-program-on-bare-metal-or1200-af67e2886fb8">RTL Simulation of C-Program on Bare-metal OR1200</a></li>
</ul></li>
<li>My researcher (Juni) did this in ‚Äô22
<ul>
<li><a href="https://cd-public.github.io/research/students/aphrodite.pdf">Bare-Metal Programs on RISC-V</a></li>
</ul></li>
<li>I did this‚Ä¶ last week.
<ul>
<li><a href="https://vcd2df.github.io/pnsqc/#/demonstration">Slides including bare-metal execution in Verilog</a></li>
</ul></li>
</ul>
</section>
<section id="bare-metal" class="slide level2">
<h2>Bare Metal</h2>
<blockquote>
<p><a href="https://en.wikipedia.org/wiki/Bare_machine">A computer which has no operating system. The software executed by a bare machine, commonly called a ‚Äúbare metal program‚Äù or ‚Äúbare metal application‚Äù, is designed to interact directly with hardware. Bare machines are widely used in embedded systems, particularly in cases where resources are limited or high performance is required.</a></p>
</blockquote>
</section>
<section id="some-terms" class="slide level2">
<h2>Some Terms</h2>
<ul>
<li>Should introduce a few terms.
<ul>
<li>Not required for OS but useful to know.</li>
</ul></li>
<li>Terms
<ul>
<li>Simulation</li>
<li>Emulation</li>
<li>Cross-compilation</li>
<li>QEMU</li>
</ul></li>
</ul>
</section>
<section id="simulation" class="slide level2">
<h2>Simulation</h2>
<ul>
<li>Models a system‚Äôs behavior</li>
<li>Focuses on high-level results, not internal logic</li>
<li>‚ÄúClose enough‚Äù for performance or logic testing</li>
<li>Simulating hardware components in software</li>
<li>Faster but less precise</li>
</ul>
</section>
<section id="emulation" class="slide level2">
<h2>Emulation</h2>
<ul>
<li>Replicating exact internal behavior of hardware</li>
<li>Software acting as hardware (CPU, registers, memory)</li>
<li><strong>Accuracy vs.&nbsp;Speed</strong>:
<ul>
<li>Much slower than simulation‚Ä¶ unless?</li>
<li>Goal: Guest software doesn‚Äôt know it‚Äôs not on actual silicon</li>
</ul></li>
</ul>
</section>
<section id="example" class="slide level2">
<h2>Example</h2>
<ul>
<li><code>x86-64</code> - the Intel/AMD architecture common for Linux and Windows - supports a ‚Äúlong double‚Äù float with 80 bits of precision.</li>
<li><code>ARM64</code> - a competing formulation most popularized as ‚ÄúApple silicon‚Äù with the M1 - lacks long doubles.</li>
</ul>
</section>
<section id="context" class="slide level2">
<h2>Context</h2>
<ul>
<li>It is trivial to implement a float in software‚Ä¶
<ul>
<li><a href="https://cd-c89.github.io/rs/51_f16.html"><code>f16</code></a></li>
</ul></li>
<li>It is relatively not-trivial to implement <em>an architecture</em> in software, though possible.
<ul>
<li>Here‚Äôs the smallest example I know:</li>
<li><a href="https://github.com/YosysHQ/picorv32">PicoRV32</a></li>
</ul></li>
</ul>
</section>
<section id="cross-compiling" class="slide level2">
<h2>Cross-Compiling</h2>
<ul>
<li>Example:‚Äù compiling code <em>on</em> an x86 laptop <em>for</em> an ARM chip
<ul>
<li>Common in embedded applications (e.g.&nbsp;program a thermostat)</li>
</ul></li>
<li>Compiler runs on Host A, produces binary for Target B
<ul>
<li>Essential for ‚Äúbare metal‚Äù development</li>
<li>Transmit the binary over wires (the bus!) to another device‚Äôs memory.</li>
</ul></li>
</ul>
</section>
<section id="considerations" class="slide level2">
<h2>Considerations</h2>
<ul>
<li>We must:
<ul>
<li><strong>Target</strong> a specific architecture</li>
<li><strong>Link</strong> against specific hardware memory maps</li>
</ul></li>
<li>Somehow you also need the actual hardware, unless‚Ä¶</li>
</ul>
</section>
<section id="qemu" class="slide level2">
<h2>QEMU</h2>
<ul>
<li>I used this a lot in grad school; less now.
<ul>
<li>Supports both emulation and virtualization
<ul>
<li>Virtualization emulates a device rather than a binary.</li>
<li>Used in cloud; can be fast; huge research area.</li>
</ul></li>
</ul></li>
<li>Let‚Äôs us run bare metal binaries without physical chips (which would cost $)</li>
<li>Write locally <span class="math inline">\(\rightarrow\)</span> Cross-compile <span class="math inline">\(\rightarrow\)</span> Run in QEMU</li>
</ul>
</section></section>
<section>
<section id="binary" class="title-slide slide level1 center">
<h1>Binary</h1>

</section>
<section id="first-steps" class="slide level2">
<h2>First Steps</h2>
<ul>
<li>The first step in creating our own operating system kernel is to create a Rust executable that does not link the standard library.</li>
<li>This makes it possible to run Rust code on the ‚Äúbare metal‚Äù without an underlying operating system.</li>
</ul>
</section>
<section id="introduction" class="slide level2">
<h2>Introduction</h2>
<ul>
<li>To write an operating system kernel, we need code that does not depend on any operating system features.</li>
<li>This means that we can‚Äôt use files, the heap, networks, random numbers, standard output, etc.</li>
<li>We‚Äôre trying to write our own OS!</li>
</ul>
</section>
<section id="on-std" class="slide level2">
<h2>On <code>std</code></h2>
<ul>
<li>We can‚Äôt use most of the Rust standard library, but‚Ä¶</li>
<li>‚Ä¶there are a lot of Rust features that we <em>can</em> use.</li>
<li>For example, we can use iterators, closures, pattern matching, <code>option</code> and <code>result</code>
<ul>
<li>Recall the official Calvin Deutschbein position on <code>option</code> and <code>result</code>:</li>
<li>‚ÄúIt‚Äôs why Rust is good.‚Äù - me</li>
</ul></li>
</ul>
</section>
<section id="on-std-1" class="slide level2">
<h2>On <code>std</code></h2>
<ul>
<li>While not initially helpful, we can use string formatting, and‚Ä¶</li>
<li>‚Ä¶ the ownership system.
<ul>
<li>Beats <code>malloc</code>!</li>
</ul></li>
</ul>
</section>
<section id="quoth-the-blog" class="slide level2">
<h2>Quoth The Blog</h2>
<blockquote>
<p>These features make it possible to write a kernel in a very expressive, high level way without worrying about undefined behavior or memory safety.</p>
</blockquote>
<ul>
<li>Well, we‚Äôll see.</li>
</ul>
</section>
<section id="we-keep" class="slide level2 smaller">
<h2>We keep</h2>
<ul>
<li><a href="https://doc.rust-lang.org/core/option/">option</a></li>
<li><a href="https://doc.rust-lang.org/core/result/">result</a></li>
<li><a href="https://doc.rust-lang.org/std/">Rust standard library</a></li>
<li><a href="https://doc.rust-lang.org/book/ch13-02-iterators.html">iterators</a></li>
<li><a href="https://doc.rust-lang.org/book/ch13-01-closures.html">closures</a></li>
<li><a href="https://doc.rust-lang.org/book/ch06-00-enums.html">pattern matching</a></li>
<li><a href="https://doc.rust-lang.org/core/macro.write.html">string formatting</a></li>
<li><a href="https://doc.rust-lang.org/book/ch04-00-understanding-ownership.html">ownership system</a></li>
<li><a href="https://www.nayuki.io/page/undefined-behavior-in-c-and-cplusplus-programs">undefined behavior</a></li>
<li><a href="https://tonyarcieri.com/it-s-time-for-a-memory-safety-intervention">memory safety</a></li>
</ul>
</section>
<section id="onward" class="slide level2">
<h2>Onward!</h2>
<ul>
<li>We now enumerate the necessary steps to create a freestanding Rust binary‚Ä¶</li>
<li>‚Ä¶and explains why the steps are needed.</li>
</ul>
</section>
<section id="no_std" class="slide level2">
<h2><code>no_std</code></h2>
<ul>
<li>By default, all Rust crates link the standard library.
<ul>
<li>It depends on the operating system for features such as threads, files, or networking.</li>
<li>It also depends on the C standard library <code>libc</code>, which closely interacts with OS services.
<ul>
<li>That is, part of GNU but not part of Linux.</li>
</ul></li>
</ul></li>
</ul>
</section>
<section id="no_std-1" class="slide level2">
<h2><code>no_std</code></h2>
<ul>
<li>Since our plan is to write an operating system, we can‚Äôt use any OS-dependent libraries.
<ul>
<li>That would be recursive, which is only good sometimes!</li>
</ul></li>
<li>So we have to disable the automatic inclusion of the standard library through the <code>no_std</code> attribute.
<ul>
<li><a href="https://doc.rust-lang.org/std/">standard library</a></li>
<li><a href="https://doc.rust-lang.org/1.30.0/book/first-edition/using-rust-without-the-standard-library.html"><code>no_std</code> attribute</a></li>
</ul></li>
</ul>
</section>
<section id="to-begin" class="slide level2">
<h2>To begin</h2>
<ul>
<li>We can start creation the same way we make anything else in Rust‚Ä¶</li>
<li><em>Cargo</em> (sighs heavily)</li>
<li>We will introduce only two wrinkles.
<ul>
<li><code>--bin</code>: we want to create an executable binary (in contrast to a library)</li>
<li><code>--edition 2024</code>: to maintain consistency across years and with the working example.</li>
</ul></li>
</ul>
</section>
<section id="invoke-as" class="slide level2">
<h2>Invoke as</h2>
<div class="sourceCode" id="cb1"><pre class="sourceCode numberSource sh number-lines code-with-copy"><code class="sourceCode bash"><span id="cb1-1"><a></a><span class="ex">cargo</span> new <span class="pp">????</span> <span class="at">--bin</span> <span class="at">--edition</span> 2024</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="example-1" class="slide level2">
<h2>Example</h2>
<ul>
<li>Personally, I would expect you to maintain different OS versions with same crate name but within distinctly named directories (<code>32</code>,<code>42</code> etc.)</li>
</ul>
<div class="sourceCode" id="cb2"><pre class="sourceCode numberSource sh number-lines code-with-copy"><code class="sourceCode bash"><span id="cb2-1"><a></a><span class="ex">cargo</span> new 32 <span class="at">--name</span> osirs <span class="at">--vcs</span> none <span class="at">--bin</span> <span class="at">--edition</span> 2024</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="branches" class="slide level2">
<h2>Branches</h2>
<ul>
<li>A competing formulation would be to use <code>git branch</code> to create different developmental branches.</li>
<li>This is the industry standard and I wanted to introduce it but felt a time crunch.</li>
<li>If you are looking for something to do, figure it out.
<ul>
<li>Don‚Äôt worry about me finding things; its worth it to me for you to learn.</li>
</ul></li>
</ul>
</section>
<section id="name" class="slide level2">
<h2>Name</h2>
<div class="columns">
<div class="column" style="width:50%;">
<ul>
<li>You don‚Äôt have to name your OS anything in particular, I just thought <code>osirs</code> (OS in Rust) sounded heckin‚Äô rad.</li>
<li><a href="https://en.wikipedia.org/wiki/Osiris"> ô·¥è·¥° ·¥Ö·¥è·¥°…¥  ô·¥á“ì·¥è Ä·¥á ·¥õ ú·¥á …¢·¥è·¥Ö ·¥è“ì ·¥Ö·¥á·¥Ä·¥õ ú</a></li>
<li>Also a cringe AI real estate firm!</li>
</ul>
</div><div class="column" style="width:50%;">
<p><img data-src="https://upload.wikimedia.org/wikipedia/commons/thumb/8/8b/Standing_Osiris.svg/330px-Standing_Osiris.svg.png"></p>
</div></div>
</section>
<section id="refresh" class="slide level2">
<h2>Refresh</h2>
<ul>
<li>When we run the command, cargo creates the following directory structure for us:</li>
</ul>
<div class="sourceCode" id="cb3"><pre class="sourceCode numberSource sh number-lines code-with-copy"><code class="sourceCode bash"><span id="cb3-1"><a></a><span class="ex">$</span> tree</span>
<span id="cb3-2"><a></a><span class="bu">.</span></span>
<span id="cb3-3"><a></a><span class="ex">‚îú‚îÄ‚îÄ</span> Cargo.toml</span>
<span id="cb3-4"><a></a><span class="ex">‚îî‚îÄ‚îÄ</span> src</span>
<span id="cb3-5"><a></a>    <span class="ex">‚îî‚îÄ‚îÄ</span> main.rs</span>
<span id="cb3-6"><a></a></span>
<span id="cb3-7"><a></a><span class="ex">1</span> directory, 2 files</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="recall" class="slide level2">
<h2>Recall</h2>
<ul>
<li><code>Cargo.toml</code> contains the crate configuration
<ul>
<li>Crate name</li>
<li>Crate author</li>
<li>Crate version</li>
</ul></li>
<li><code>src/main.rs</code> file contains our <code>main</code> function.</li>
<li>After <code>cargo build</code>, find the compiled <code>osirs</code> binary in the <code>target/debug</code> subfolder.</li>
</ul>
</section>
<section id="blah-blah-blah" class="slide level2">
<h2>Blah blah blah</h2>
<div class="sourceCode" id="cb4"><pre class="sourceCode numberSource sh number-lines code-with-copy"><code class="sourceCode bash"><span id="cb4-1"><a></a><span class="ex">$</span> cargo build <span class="kw">;</span> <span class="ex">tree</span></span>
<span id="cb4-2"><a></a>   <span class="ex">Compiling</span> osirs v0.1.0 <span class="er">(</span><span class="ex">/home/user/tmp/32</span><span class="kw">)</span></span>
<span id="cb4-3"><a></a>    <span class="ex">Finished</span> <span class="kw">`</span><span class="ex">dev</span><span class="kw">`</span> profile [unoptimized + debuginfo] target<span class="er">(</span><span class="ex">s</span><span class="kw">)</span> <span class="er">in</span> <span class="ex">0.54s</span></span>
<span id="cb4-4"><a></a><span class="bu">.</span></span>
<span id="cb4-5"><a></a><span class="ex">‚îú‚îÄ‚îÄ</span> Cargo.lock</span>
<span id="cb4-6"><a></a><span class="ex">‚îú‚îÄ‚îÄ</span> Cargo.toml</span>
<span id="cb4-7"><a></a><span class="ex">‚îú‚îÄ‚îÄ</span> src</span>
<span id="cb4-8"><a></a><span class="ex">‚îÇ&nbsp;&nbsp;</span> ‚îî‚îÄ‚îÄ main.rs</span>
<span id="cb4-9"><a></a><span class="ex">‚îî‚îÄ‚îÄ</span> target</span>
<span id="cb4-10"><a></a>    <span class="ex">‚îú‚îÄ‚îÄ</span> CACHEDIR.TAG</span>
<span id="cb4-11"><a></a>    <span class="ex">‚îî‚îÄ‚îÄ</span> debug</span>
<span id="cb4-12"><a></a>        <span class="ex">‚îú‚îÄ‚îÄ</span> build</span>
<span id="cb4-13"><a></a>        <span class="ex">‚îú‚îÄ‚îÄ</span> deps</span>
<span id="cb4-14"><a></a>        <span class="ex">‚îÇ&nbsp;&nbsp;</span> ‚îú‚îÄ‚îÄ osirs-43412975b38d059d</span>
<span id="cb4-15"><a></a>        <span class="ex">‚îÇ&nbsp;&nbsp;</span> ‚îî‚îÄ‚îÄ osirs-43412975b38d059d.d</span>
<span id="cb4-16"><a></a>        <span class="ex">‚îú‚îÄ‚îÄ</span> examples</span>
<span id="cb4-17"><a></a>        <span class="ex">‚îú‚îÄ‚îÄ</span> incremental</span>
<span id="cb4-18"><a></a>        <span class="ex">‚îÇ&nbsp;&nbsp;</span> ‚îî‚îÄ‚îÄ osirs-3gae52yq1943v</span>
<span id="cb4-19"><a></a>        <span class="ex">‚îÇ&nbsp;&nbsp;</span>     ‚îú‚îÄ‚îÄ s-hfeunnoewq-0c8luu5-5dmhke08rl6h5l09ku3va3gkx</span>
<span id="cb4-20"><a></a>        <span class="ex">‚îÇ&nbsp;&nbsp;</span>     ‚îÇ&nbsp;&nbsp; ‚îú‚îÄ‚îÄ 1tq3ts5gahvv7j1hzrmfdrzi6.o</span>
<span id="cb4-21"><a></a>        <span class="ex">‚îÇ&nbsp;&nbsp;</span>     ‚îÇ&nbsp;&nbsp; ‚îú‚îÄ‚îÄ 6zk3flo890c0qhh6fykb6746g.o</span>
<span id="cb4-22"><a></a>        <span class="ex">‚îÇ&nbsp;&nbsp;</span>     ‚îÇ&nbsp;&nbsp; ‚îú‚îÄ‚îÄ 8z45o15v3gxm5hydv3o63x07l.o</span>
<span id="cb4-23"><a></a>        <span class="ex">‚îÇ&nbsp;&nbsp;</span>     ‚îÇ&nbsp;&nbsp; ‚îú‚îÄ‚îÄ 9itjtn00r7d8c6mknmav20oex.o</span>
<span id="cb4-24"><a></a>        <span class="ex">‚îÇ&nbsp;&nbsp;</span>     ‚îÇ&nbsp;&nbsp; ‚îú‚îÄ‚îÄ bh9pj42wzikjd1ilqutnjbrx7.o</span>
<span id="cb4-25"><a></a>        <span class="ex">‚îÇ&nbsp;&nbsp;</span>     ‚îÇ&nbsp;&nbsp; ‚îú‚îÄ‚îÄ dep-graph.bin</span>
<span id="cb4-26"><a></a>        <span class="ex">‚îÇ&nbsp;&nbsp;</span>     ‚îÇ&nbsp;&nbsp; ‚îú‚îÄ‚îÄ eymyqxruzdb24suchgzd8ygxb.o</span>
<span id="cb4-27"><a></a>        <span class="ex">‚îÇ&nbsp;&nbsp;</span>     ‚îÇ&nbsp;&nbsp; ‚îú‚îÄ‚îÄ query-cache.bin</span>
<span id="cb4-28"><a></a>        <span class="ex">‚îÇ&nbsp;&nbsp;</span>     ‚îÇ&nbsp;&nbsp; ‚îî‚îÄ‚îÄ work-products.bin</span>
<span id="cb4-29"><a></a>        <span class="ex">‚îÇ&nbsp;&nbsp;</span>     ‚îî‚îÄ‚îÄ s-hfeunnoewq-0c8luu5.lock</span>
<span id="cb4-30"><a></a>        <span class="ex">‚îú‚îÄ‚îÄ</span> osirs</span>
<span id="cb4-31"><a></a>        <span class="ex">‚îî‚îÄ‚îÄ</span> osirs.d</span>
<span id="cb4-32"><a></a></span>
<span id="cb4-33"><a></a><span class="ex">9</span> directories, 18 files</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="running" class="slide level2">
<h2>Running</h2>
<ul>
<li>Technically no one can stop you from using <code>cargo run</code> or even <code>cargo run --release</code></li>
<li>But you can also just <code>build</code> and then <em>directly</em> run the executable.</li>
</ul>
<div class="sourceCode" id="cb5"><pre class="sourceCode numberSource sh number-lines code-with-copy"><code class="sourceCode bash"><span id="cb5-1"><a></a><span class="ex">$</span> ./target/debug/osirs</span>
<span id="cb5-2"><a></a><span class="ex">Hello,</span> world!</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="the-no_std-attribute" class="slide level2">
<h2>The <code>no_std</code> Attribute</h2>
<ul>
<li>Initially, the crate implicitly links the standard library.</li>
<li>We can prepend the <code>no_std</code> attribute to <code>src/main.rs</code> to get the version of Rust that builds character!</li>
</ul>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>src/main.rs</strong></pre>
</div>
<div class="sourceCode" id="cb6" data-filename="src/main.rs"><pre class="sourceCode numberSource rs number-lines code-with-copy"><code class="sourceCode rust"><span id="cb6-1"><a></a><span class="co">// main.rs</span></span>
<span id="cb6-2"><a></a></span>
<span id="cb6-3"><a></a><span class="at">#![</span>no_std<span class="at">]</span></span>
<span id="cb6-4"><a></a></span>
<span id="cb6-5"><a></a><span class="kw">fn</span> main() <span class="op">{</span></span>
<span id="cb6-6"><a></a>    <span class="pp">println!</span>(<span class="st">" ô·¥è·¥° ·¥Ö·¥è·¥°…¥  ô·¥á“ì·¥è Ä·¥á ·¥õ ú·¥á …¢·¥è·¥Ö ·¥è“ì ·¥Ö·¥á·¥Ä·¥õ ú"</span>)<span class="op">;</span></span>
<span id="cb6-7"><a></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="we-can-rebuild" class="slide level2">
<h2>We Can Rebuild</h2>
<ul>
<li>Actually we can‚Äôt.</li>
</ul>
<div class="sourceCode" id="cb7"><pre class="sourceCode numberSource sh number-lines code-with-copy"><code class="sourceCode bash"><span id="cb7-1"><a></a><span class="ex">$</span> cargo build</span>
<span id="cb7-2"><a></a>   <span class="ex">Compiling</span> osirs v0.1.0 <span class="er">(</span><span class="ex">/home/user/tmp/32</span><span class="kw">)</span></span>
<span id="cb7-3"><a></a><span class="ex">error:</span> cannot find macro <span class="kw">`</span><span class="ex">println</span><span class="kw">`</span> in this scope</span>
<span id="cb7-4"><a></a> <span class="ex">--</span><span class="op">&gt;</span> src/main.rs:6:5</span>
<span id="cb7-5"><a></a>  <span class="kw">|</span></span>
<span id="cb7-6"><a></a><span class="ex">6</span> <span class="kw">|</span>     <span class="ex">println!</span><span class="er">(</span><span class="st">" ô·¥è·¥° ·¥Ö·¥è·¥°…¥  ô·¥á“ì·¥è Ä·¥á ·¥õ ú·¥á …¢·¥è·¥Ö ·¥è“ì ·¥Ö·¥á·¥Ä·¥õ ú"</span><span class="kw">);</span></span>
<span id="cb7-7"><a></a>  <span class="kw">|</span>     <span class="ex">^^^^^^^</span></span>
<span id="cb7-8"><a></a></span>
<span id="cb7-9"><a></a><span class="ex">error:</span> <span class="kw">`</span><span class="co">#[panic_handler]</span><span class="kw">`</span> function required, but not found</span>
<span id="cb7-10"><a></a></span>
<span id="cb7-11"><a></a><span class="ex">error:</span> unwinding panics are not supported without std</span>
<span id="cb7-12"><a></a>  <span class="kw">|</span></span>
<span id="cb7-13"><a></a>  <span class="ex">=</span> help: using nightly cargo, use <span class="at">-Zbuild-std</span> with panic=<span class="st">"abort"</span> to avoid unwinding</span>
<span id="cb7-14"><a></a>  <span class="ex">=</span> note: since the core library is usually precompiled with panic=<span class="st">"unwind"</span>, rebuilding your crate with panic=<span class="st">"abort"</span> may not be enough to fix the problem</span>
<span id="cb7-15"><a></a></span>
<span id="cb7-16"><a></a><span class="ex">error:</span> could not compile <span class="kw">`</span><span class="ex">osirs</span><span class="kw">`</span> <span class="er">(</span><span class="ex">bin</span> <span class="st">"osirs"</span><span class="kw">)</span> <span class="ex">due</span> to 3 previous errors    ^^^^^^^</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="enhance" class="slide level2">
<h2>Enhance!</h2>
<div class="sourceCode" id="cb8"><pre class="sourceCode numberSource sh number-lines code-with-copy"><code class="sourceCode bash"><span id="cb8-1"><a></a><span class="ex">error:</span> cannot find macro <span class="kw">`</span><span class="ex">println</span><span class="kw">`</span> in this scope</span>
<span id="cb8-2"><a></a> <span class="ex">--</span><span class="op">&gt;</span> src/main.rs:6:5</span>
<span id="cb8-3"><a></a>  <span class="kw">|</span></span>
<span id="cb8-4"><a></a><span class="ex">6</span> <span class="kw">|</span>     <span class="ex">println!</span><span class="er">(</span><span class="st">" ô·¥è·¥° ·¥Ö·¥è·¥°…¥  ô·¥á“ì·¥è Ä·¥á ·¥õ ú·¥á …¢·¥è·¥Ö ·¥è“ì ·¥Ö·¥á·¥Ä·¥õ ú"</span><span class="kw">);</span></span>
<span id="cb8-5"><a></a>  <span class="kw">|</span>     <span class="ex">^^^^^^^</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ul>
<li>Oh right, we can‚Äôt print without an OS.</li>
</ul>
</section>
<section id="background" class="slide level2">
<h2>Background</h2>
<ul>
<li>The <code>println</code> macro is part of the standard library <code>std</code>.</li>
<li>We said <code>no_std</code>.</li>
<li>So we can no longer print things.</li>
<li>I hope it is clear how this is character-building!</li>
<li>Read more:
<ul>
<li><a href="https://doc.rust-lang.org/std/macro.println.html"><code>println</code> macro</a></li>
<li><a href="https://en.wikipedia.org/wiki/Standard_streams#Standard_output_.28stdout.29">standard output</a></li>
</ul></li>
</ul>
</section>
<section id="rip-it" class="slide level2">
<h2>Rip it</h2>
<ul>
<li>Remove the printing and try again:</li>
</ul>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>src/main.rs</strong></pre>
</div>
<div class="sourceCode" id="cb9" data-filename="src/main.rs"><pre class="sourceCode numberSource rs number-lines code-with-copy"><code class="sourceCode rust"><span id="cb9-1"><a></a><span class="co">// main.rs</span></span>
<span id="cb9-2"><a></a></span>
<span id="cb9-3"><a></a><span class="at">#![</span>no_std<span class="at">]</span></span>
<span id="cb9-4"><a></a></span>
<span id="cb9-5"><a></a><span class="kw">fn</span> main() <span class="op">{</span></span>
<span id="cb9-6"><a></a>    <span class="co">// println!(" ô·¥è·¥° ·¥Ö·¥è·¥°…¥  ô·¥á“ì·¥è Ä·¥á ·¥õ ú·¥á …¢·¥è·¥Ö ·¥è“ì ·¥Ö·¥á·¥Ä·¥õ ú");</span></span>
<span id="cb9-7"><a></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="problems-remain" class="slide level2">
<h2>Problems remain</h2>
<div class="sourceCode" id="cb10"><pre class="sourceCode numberSource sh number-lines code-with-copy"><code class="sourceCode bash"><span id="cb10-1"><a></a><span class="ex">$</span> cargo build</span>
<span id="cb10-2"><a></a>   <span class="ex">Compiling</span> osirs v0.1.0 <span class="er">(</span><span class="ex">/home/user/tmp/32</span><span class="kw">)</span></span>
<span id="cb10-3"><a></a><span class="ex">error:</span> <span class="kw">`</span><span class="co">#[panic_handler]</span><span class="kw">`</span> function required, but not found</span>
<span id="cb10-4"><a></a></span>
<span id="cb10-5"><a></a><span class="ex">error:</span> unwinding panics are not supported without std</span>
<span id="cb10-6"><a></a>  <span class="kw">|</span></span>
<span id="cb10-7"><a></a>  <span class="ex">=</span> help: using nightly cargo, use <span class="at">-Zbuild-std</span> with panic=<span class="st">"abort"</span> to avoid unwinding</span>
<span id="cb10-8"><a></a>  <span class="ex">=</span> note: since the core library is usually precompiled with panic=<span class="st">"unwind"</span>, rebuilding your crate with panic=<span class="st">"abort"</span> may not be enough to fix the problem</span>
<span id="cb10-9"><a></a></span>
<span id="cb10-10"><a></a><span class="ex">error:</span> could not compile <span class="kw">`</span><span class="ex">osirs</span><span class="kw">`</span> <span class="er">(</span><span class="ex">bin</span> <span class="st">"osirs"</span><span class="kw">)</span> <span class="ex">due</span> to 2 previous errors</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="enhance-1" class="slide level2">
<h2>Enhance!</h2>
<div class="sourceCode" id="cb11"><pre class="sourceCode numberSource sh number-lines code-with-copy"><code class="sourceCode bash"><span id="cb11-1"><a></a><span class="ex">error:</span> cannot find macro <span class="kw">`</span><span class="ex">println</span><span class="kw">`</span> in this scope</span>
<span id="cb11-2"><a></a> <span class="ex">--</span><span class="op">&gt;</span> src/main.rs:6:5</span>
<span id="cb11-3"><a></a>  <span class="kw">|</span></span>
<span id="cb11-4"><a></a><span class="ex">6</span> <span class="kw">|</span>     <span class="ex">println!</span><span class="er">(</span><span class="st">" ô·¥è·¥° ·¥Ö·¥è·¥°…¥  ô·¥á“ì·¥è Ä·¥á ·¥õ ú·¥á …¢·¥è·¥Ö ·¥è“ì ·¥Ö·¥á·¥Ä·¥õ ú"</span><span class="kw">);</span></span>
<span id="cb11-5"><a></a>  <span class="kw">|</span>     <span class="ex">^^^^^^^</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ul>
<li>Sometimes, Rust explodes and calls the OS (written in C!) for help.</li>
<li>It can‚Äôt do that without <code>std</code> and is sad üò≠</li>
</ul>
</section>
<section id="panic" class="slide level2">
<h2>Panic</h2>
<ul>
<li>The <code>panic_handler</code> attribute defines the function that the compiler should invoke when a panic occurs.</li>
<li><code>std</code> provides its own panic handler function, but in a <code>no_std</code> environment we need to define it ourselves:</li>
<li><a href="https://doc.rust-lang.org/stable/book/ch09-01-unrecoverable-errors-with-panic.html">panic</a></li>
</ul>
</section>
<section id="our-approach" class="slide level2">
<h2>Our Approach</h2>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>src/main.rs</strong></pre>
</div>
<div class="sourceCode" id="cb12" data-filename="src/main.rs"><pre class="sourceCode numberSource rs number-lines code-with-copy"><code class="sourceCode rust"><span id="cb12-1"><a></a><span class="co">// main.rs</span></span>
<span id="cb12-2"><a></a></span>
<span id="cb12-3"><a></a><span class="co">/// This function is called on panic.</span></span>
<span id="cb12-4"><a></a><span class="at">#[</span>panic_handler<span class="at">]</span></span>
<span id="cb12-5"><a></a><span class="kw">fn</span> panic(_info<span class="op">:</span> <span class="op">&amp;</span><span class="pp">core::panic::</span>PanicInfo) <span class="op">-&gt;</span> <span class="op">!</span> <span class="op">{</span></span>
<span id="cb12-6"><a></a>    <span class="cf">loop</span> <span class="op">{}</span></span>
<span id="cb12-7"><a></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="panics" class="slide level2">
<h2>Panics</h2>
<ul>
<li>The <code>PanicInfo</code> parameter contains:
<ul>
<li><em>file</em> and <em>line</em> where the panic happened</li>
<li>panic message (e.g.&nbsp;<code>panic!("YOLO")</code></li>
</ul></li>
<li>The function should never return.
<ul>
<li>So it is marked as a ‚Äúdiverging function‚Äù</li>
<li>It returns the ‚Äúnever‚Äù type <code>!</code>.</li>
</ul></li>
<li>Not much we can do in this function for now, so just <code>loop()</code> to prevent a return.</li>
</ul>
</section>
<section id="read-more" class="slide level2">
<h2>Read more‚Ä¶</h2>
<ul>
<li>I had never heard of or used these but to me it was clear why they would have to exist in a type safe language.
<ul>
<li><a href="https://doc.rust-lang.org/nightly/core/panic/struct.PanicInfo.html">PanicInfo</a></li>
<li><a href="https://doc.rust-lang.org/1.30.0/book/first-edition/functions.html#diverging-functions">diverging function</a></li>
<li><a href="https://doc.rust-lang.org/nightly/std/primitive.never.html">‚Äúnever‚Äù type</a></li>
</ul></li>
</ul>
<!--

## The `eh_personality` Language Item

Language items are special functions and types that are required internally by the compiler. For example, the [`Copy`] trait is a language item that tells the compiler which types have [_copy semantics_][`Copy`]. When we look at the [implementation][copy code], we see it has the special `#[lang = "copy"]` attribute that defines it as a language item.

[`Copy`]: https://doc.rust-lang.org/nightly/core/marker/trait.Copy.html
[copy code]: https://github.com/rust-lang/rust/blob/485397e49a02a3b7ff77c17e4a3f16c653925cb3/src/libcore/marker.rs#L296-L299

While providing custom implementations of language items is possible, it should only be done as a last resort. The reason is that language items are highly unstable implementation details and not even type checked (so the compiler doesn't even check if a function has the right argument types). Fortunately, there is a more stable way to fix the above language item error.

The [`eh_personality` language item] marks a function that is used for implementing [stack unwinding]. By default, Rust uses unwinding to run the destructors of all live stack variables in case of a [panic]. This ensures that all used memory is freed and allows the parent thread to catch the panic and continue execution. Unwinding, however, is a complicated process and requires some OS-specific libraries (e.g. [libunwind] on Linux or [structured exception handling] on Windows), so we don't want to use it for our operating system.

[`eh_personality` language item]: https://github.com/rust-lang/rust/blob/edb368491551a77d77a48446d4ee88b35490c565/src/libpanic_unwind/gcc.rs#L11-L45
[stack unwinding]: https://www.bogotobogo.com/cplusplus/stackunwinding.php
[libunwind]: https://www.nongnu.org/libunwind/
[structured exception handling]: https://docs.microsoft.com/en-us/windows/win32/debug/structured-exception-handling

-->
</section>
<section id="retry" class="slide level2">
<h2>Retry</h2>
<ul>
<li>I bet it works now!</li>
</ul>
<div class="sourceCode" id="cb13"><pre class="sourceCode numberSource sh number-lines code-with-copy"><code class="sourceCode bash"><span id="cb13-1"><a></a><span class="ex">$</span> cargo build</span>
<span id="cb13-2"><a></a>   <span class="ex">Compiling</span> osirs v0.1.0 <span class="er">(</span><span class="ex">/home/user/tmp/32</span><span class="kw">)</span></span>
<span id="cb13-3"><a></a><span class="ex">error:</span> unwinding panics are not supported without std</span>
<span id="cb13-4"><a></a>  <span class="kw">|</span></span>
<span id="cb13-5"><a></a>  <span class="ex">=</span> help: using nightly cargo, use <span class="at">-Zbuild-std</span> with panic=<span class="st">"abort"</span> to avoid unwinding</span>
<span id="cb13-6"><a></a>  <span class="ex">=</span> note: since the core library is usually precompiled with panic=<span class="st">"unwind"</span>, rebuilding your crate with panic=<span class="st">"abort"</span> may not be enough to fix the problem</span>
<span id="cb13-7"><a></a></span>
<span id="cb13-8"><a></a><span class="ex">error:</span> could not compile <span class="kw">`</span><span class="ex">osirs</span><span class="kw">`</span> <span class="er">(</span><span class="ex">bin</span> <span class="st">"osirs"</span><span class="kw">)</span> <span class="ex">due</span> to 1 previous error</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ul>
<li>They should make a version of the OS class that is easy.
<ul>
<li>(They did - this class)</li>
</ul></li>
</ul>
</section>
<section id="panic-abort" class="slide level2">
<h2>Panic abort</h2>
<div class="columns">
<div class="column" style="width:50%;">
<ul>
<li>Fun fact - back when I was an OS engineer slash rocket scientist my first launch was <a href="https://en.wikipedia.org/wiki/Pad_Abort-1">‚ÄúPA-1‚Äù for ‚ÄúPad Abort 1‚Äù</a>
<ul>
<li>Blew up a rocket on the launch pad to make sure it was safe for humans.</li>
</ul></li>
</ul>
</div><div class="column" style="width:50%;">
<p><img data-src="https://upload.wikimedia.org/wikipedia/commons/thumb/d/d6/450775main_wstf0510e04493_hires.jpg/330px-450775main_wstf0510e04493_hires.jpg"></p>
</div></div>
</section>
<section id="panic-abort-1" class="slide level2">
<h2>Panic abort</h2>
<ul>
<li>The use of the term ‚Äúabort‚Äù which in some nation-states is a hot-button political issue has come up from time-to-time in the discourse.</li>
<li><a href="https://www.theregister.com/2018/05/09/gnu_glic_abort_stallman/">Read more from 2018</a></li>
</ul>
<div class="sourceCode" id="cb14"><pre class="sourceCode numberSource email number-lines code-with-copy"><code class="sourceCode email"><span id="cb14-1"><a></a></span>
<span id="cb14-2"><a></a>25.7.4 Aborting a Program</span>
<span id="cb14-3"><a></a></span>
<span id="cb14-4"><a></a>...</span>
<span id="cb14-5"><a></a></span>
<span id="cb14-6"><a></a>Future Change Warning: Proposed Federal censorship regulations may prohibit us from giving you information about the possibility of calling this function. We would be required to say that this is not an acceptable way of terminating a program.</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="quoth-stallman" class="slide level2">
<h2>Quoth Stallman</h2>
<blockquote>
<p>‚ÄúThe point of this joke is even more important now than it was when I first wrote it,‚Äù [Free Software Foundation president] Stallman wrote in a note posted to project mailing list, in reference to today‚Äôs political climate. ‚ÄúPlease do not remove it. GNU is not a purely technical project, so the fact that this is not strictly and grimly technical is not a reason to remove this.‚Äù</p>
</blockquote>
</section>
<section id="now-in-rust" class="slide level2">
<h2>Now in Rust</h2>
<ul>
<li>We can oppose fascism <em>and</em>
<ul>
<li>(looks into the history of NASA and Lockheed Martin)</li>
<li>(clears throat)</li>
<li>Moving on!<br>
</li>
</ul></li>
<li>We can abort programs‚Ä¶ <em>in Rust</em></li>
</ul>
</section>
<section id="how" class="slide level2">
<h2>How?</h2>
<ul>
<li>Read carefully:</li>
</ul>
<div class="sourceCode" id="cb15"><pre class="sourceCode numberSource sh number-lines code-with-copy"><code class="sourceCode bash"><span id="cb15-1"><a></a><span class="ex">=</span> help: using nightly cargo, use <span class="at">-Zbuild-std</span> with panic=<span class="st">"abort"</span> to avoid unwinding</span>
<span id="cb15-2"><a></a><span class="ex">=</span> note: since the core library is usually precompiled with panic=<span class="st">"unwind"</span>, rebuilding your crate with panic=<span class="st">"abort"</span> may not be enough to fix the problem</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ul>
<li>Geniuses will recognize <code>panic="abort"</code> syntax</li>
</ul>
</section>
<section id="toml" class="slide level2">
<h2>TOML</h2>
<ul>
<li>It‚Äôs <code>.toml</code></li>
</ul>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>Cargo.toml</strong></pre>
</div>
<div class="sourceCode" id="cb16" data-filename="Cargo.toml"><pre class="sourceCode numberSource toml number-lines code-with-copy"><code class="sourceCode toml"><span id="cb16-1"><a></a><span class="kw">[package]</span></span>
<span id="cb16-2"><a></a><span class="dt">name</span> <span class="op">=</span> <span class="st">"osirs"</span></span>
<span id="cb16-3"><a></a><span class="dt">version</span> <span class="op">=</span> <span class="st">"0.1.0"</span></span>
<span id="cb16-4"><a></a><span class="dt">edition</span> <span class="op">=</span> <span class="st">"2024"</span></span>
<span id="cb16-5"><a></a></span>
<span id="cb16-6"><a></a><span class="kw">[dependencies]</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="crate-options" class="slide level2">
<h2>Crate options</h2>
<ul>
<li>Nominally there are use cases for which unwinding is undesirable
<ul>
<li>My take: All cases.</li>
</ul></li>
<li>So Rust provides an option to ‚Äúabort on panic‚Äù instead.</li>
<li>This disables the generation of unwinding symbol information and thus considerably reduces binary size.
<ul>
<li>This seems obviously good to me.</li>
</ul></li>
</ul>
</section>
<section id="update-cargo.toml" class="slide level2">
<h2>Update <code>Cargo.toml</code></h2>
<ul>
<li>Add the following:</li>
</ul>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>Cargo.toml</strong></pre>
</div>
<div class="sourceCode" id="cb17" data-filename="Cargo.toml" data-code-line-numbers="8-12"><pre class="sourceCode numberSource toml number-lines code-with-copy"><code class="sourceCode toml"><span id="cb17-1"><a></a><span class="kw">[package]</span></span>
<span id="cb17-2"><a></a><span class="dt">name</span> <span class="op">=</span> <span class="st">"osirs"</span></span>
<span id="cb17-3"><a></a><span class="dt">version</span> <span class="op">=</span> <span class="st">"0.1.0"</span></span>
<span id="cb17-4"><a></a><span class="dt">edition</span> <span class="op">=</span> <span class="st">"2024"</span></span>
<span id="cb17-5"><a></a></span>
<span id="cb17-6"><a></a><span class="kw">[dependencies]</span></span>
<span id="cb17-7"><a></a></span>
<span id="cb17-8"><a></a><span class="kw">[profile.dev]</span></span>
<span id="cb17-9"><a></a><span class="dt">panic</span> <span class="op">=</span> <span class="st">"abort"</span></span>
<span id="cb17-10"><a></a></span>
<span id="cb17-11"><a></a><span class="kw">[profile.release]</span></span>
<span id="cb17-12"><a></a><span class="dt">panic</span> <span class="op">=</span> <span class="st">"abort"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="now" class="slide level2">
<h2>Now‚Ä¶</h2>
<ul>
<li><p>This sets the panic strategy to <code>abort</code> for both the <code>dev</code> profile (used for <code>cargo build</code>) and the <code>release</code> profile (used for <code>cargo build --release</code>).</p></li>
<li><p><a href="https://github.com/rust-lang/rust/pull/32900">abort on panic</a></p></li>
<li><p>I bet it will work now.</p></li>
</ul>
</section>
<section id="whoops" class="slide level2">
<h2>Whoops!</h2>
<div class="sourceCode" id="cb18"><pre class="sourceCode numberSource sh number-lines code-with-copy"><code class="sourceCode bash"><span id="cb18-1"><a></a><span class="ex">$</span> cargo build</span>
<span id="cb18-2"><a></a>   <span class="ex">Compiling</span> osirs v0.1.0 <span class="er">(</span><span class="ex">/home/user/tmp/32</span><span class="kw">)</span></span>
<span id="cb18-3"><a></a><span class="ex">error:</span> using <span class="kw">`</span><span class="ex">fn</span> main<span class="kw">`</span> requires the standard library</span>
<span id="cb18-4"><a></a>  <span class="kw">|</span></span>
<span id="cb18-5"><a></a>  <span class="ex">=</span> help: use <span class="kw">`</span><span class="co">#![no_main]</span><span class="kw">`</span> to bypass the Rust generated entrypoint and declare a platform specific entrypoint yourself, usually with <span class="kw">`</span><span class="co">#[no_mangle]</span><span class="kw">`</span></span>
<span id="cb18-6"><a></a></span>
<span id="cb18-7"><a></a><span class="ex">error:</span> could not compile <span class="kw">`</span><span class="ex">osirs</span><span class="kw">`</span> <span class="er">(</span><span class="ex">bin</span> <span class="st">"osirs"</span><span class="kw">)</span> <span class="ex">due</span> to 1 previous error</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ul>
<li>Our program is missing the <code>start</code> language item, which defines the entry point.</li>
</ul>
</section>
<section id="the-start-attribute" class="slide level2">
<h2>The <code>start</code> attribute</h2>
<ul>
<li>One might think that the <code>main</code> function is the first function called when you run a program.</li>
<li>However, most languages have a ‚Äú<a href="https://en.wikipedia.org/wiki/Runtime_system">runtime system</a>‚Äù
<ul>
<li>For e.g.&nbsp;Java garbage collection (e.g.&nbsp;in Java)</li>
<li>For e.g.&nbsp;Go software threads (goroutines)</li>
</ul></li>
<li>This runtime needs to be called before <code>main</code>, since it needs to initialize itself.</li>
</ul>
</section>
<section id="c-again" class="slide level2">
<h2>C, again</h2>
<ul>
<li>In a typical Rust binary that links the standard library, execution starts in a C runtime library
<ul>
<li><code>crt0</code> for ‚ÄúC runtime zero‚Äù</li>
</ul></li>
<li>This creates a stack and places the arguments in the right hardware registers.</li>
<li>The C runtime then invokes the entry point of the Rust runtime, which is marked by the <code>start</code> language item.</li>
</ul>
</section>
<section id="back-to-rust" class="slide level2">
<h2>Back to Rust</h2>
<ul>
<li>Rust only has a very minimal runtime, which takes care of some small things such as setting up stack overflow guards or printing a backtrace on panic.</li>
<li>The runtime then finally calls the <code>main</code> function.</li>
</ul>
</section>
<section id="crt0-is-cheating" class="slide level2">
<h2><code>crt0</code> is cheating</h2>
<ul>
<li>Our freestanding executable does not have access to the Rust runtime and <code>crt0</code></li>
<li>We need to define our own entry point. = Implementing the <code>start</code> language item wouldn‚Äôt help, since it would still require <code>crt0</code>.</li>
<li>Instead, we need to overwrite the <code>crt0</code> entry point directly.</li>
</ul>
<h3 id="overwriting">Overwriting</h3>
<ul>
<li>To tell the Rust compiler that we don‚Äôt want to use the normal entry point chain, we add the <code>#![no_main]</code> attribute.</li>
</ul>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>src/main.rs</strong></pre>
</div>
<div class="sourceCode" id="cb19" data-filename="src/main.rs"><pre class="sourceCode numberSource rs number-lines code-with-copy"><code class="sourceCode rust"><span id="cb19-1"><a></a><span class="co">// main.rs</span></span>
<span id="cb19-2"><a></a></span>
<span id="cb19-3"><a></a><span class="at">#![</span>no_std<span class="at">]</span></span>
<span id="cb19-4"><a></a><span class="at">#![</span>no_main<span class="at">]</span></span>
<span id="cb19-5"><a></a></span>
<span id="cb19-6"><a></a><span class="co">/// This function is called on panic.</span></span>
<span id="cb19-7"><a></a><span class="at">#[</span>panic_handler<span class="at">]</span></span>
<span id="cb19-8"><a></a><span class="kw">fn</span> panic(_info<span class="op">:</span> <span class="op">&amp;</span><span class="pp">core::panic::</span>PanicInfo) <span class="op">-&gt;</span> <span class="op">!</span> <span class="op">{</span></span>
<span id="cb19-9"><a></a>    <span class="cf">loop</span> <span class="op">{}</span></span>
<span id="cb19-10"><a></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="no-main-in-main" class="slide level2">
<h2>No main in main</h2>
<ul>
<li>At this point we can also remove the <code>main</code> function.</li>
<li>Absent a compatible runtime, <code>main</code> is meaningless!</li>
<li>If you <code>cargo build</code> at this point, by the way, you will get some fun errors.</li>
</ul>
</section>
<section id="start-in-main" class="slide level2">
<h2>Start in main</h2>
<ul>
<li>Instead, overwrite the entry point with our own <code>_start</code> function:</li>
</ul>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>src/main.rs</strong></pre>
</div>
<div class="sourceCode" id="cb20" data-filename="src/main.rs"><pre class="sourceCode numberSource rs number-lines code-with-copy"><code class="sourceCode rust"><span id="cb20-1"><a></a><span class="at">#[</span><span class="kw">unsafe</span><span class="at">(</span>no_mangle<span class="at">)]</span></span>
<span id="cb20-2"><a></a><span class="kw">pub</span> <span class="kw">extern</span> <span class="st">"C"</span> <span class="kw">fn</span> _start() <span class="op">-&gt;</span> <span class="op">!</span> <span class="op">{</span></span>
<span id="cb20-3"><a></a>    <span class="cf">loop</span> <span class="op">{}</span></span>
<span id="cb20-4"><a></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="manglin" class="slide level2">
<h2>Manglin‚Äô</h2>
<ul>
<li>By using the <code>#[unsafe(no_mangle)]</code> attribute, we disable ‚Äúname mangling‚Äù
<ul>
<li>The function <strong>must</strong> be named <code>_start</code>.</li>
</ul></li>
<li>Otherwise, compiler generates unique symbols like <code>_start_imarandomstr_1234</code> to avoid namespace collisons.
<ul>
<li>Folks‚Ä¶ it‚Äôs key-value storage.</li>
</ul></li>
<li>The attribute is required for the <em>linker</em> in the next step.</li>
</ul>
</section>
<section id="c-you-again" class="slide level2">
<h2>C you again</h2>
<ul>
<li>Mark the function as <code>extern "C"</code> to tell the compiler that it should use the ‚ÄúC calling convention‚Äù</li>
<li>The reason for naming the function <code>_start</code> is that this is the default entry point name for most systems.</li>
</ul>
</section>
<section id="read-more-1" class="slide level2">
<h2>Read more</h2>
<ul>
<li><a href="https://en.wikipedia.org/wiki/Name_mangling">name mangling</a></li>
<li><a href="https://en.wikipedia.org/wiki/Calling_convention">C calling convention</a></li>
</ul>
</section>
<section id="divergence" class="slide level2">
<h2>Divergence</h2>
<ul>
<li>The <code>!</code> return type returns!</li>
<li>This is required because the entry point is not called by any function, but invoked directly by the operating system or bootloader.
<ul>
<li>It can‚Äôt return anywhere!</li>
</ul></li>
</ul>
</section>
<section id="exit" class="slide level2">
<h2>Exit</h2>
<ul>
<li>Before I go out to the clubs I always ‚ÄúX it up‚Äù (put X‚Äôs on my hands) because I‚Äôm straight edge.</li>
<li>Operating systems are similar.</li>
<li>So instead of returning, the entry point should e.g.&nbsp;invoke the <code>exit</code> system call of the operating system.</li>
<li>For now, we fulfill the requirement by looping endlessly.</li>
<li><a href="https://en.wikipedia.org/wiki/Exit_(system_call)"><code>exit</code> system call</a></li>
</ul>
</section>
<section id="now-it-works" class="slide level2">
<h2>Now it works!</h2>
<ul>
<li>It doesn‚Äôt.</li>
</ul>
<div class="sourceCode" id="cb21"><pre class="sourceCode numberSource sh number-lines code-with-copy"><code class="sourceCode bash"><span id="cb21-1"><a></a><span class="ex">$</span> cargo build</span>
<span id="cb21-2"><a></a>   <span class="ex">Compiling</span> osirs v0.1.0 <span class="er">(</span><span class="ex">/home/user/tmp/32</span><span class="kw">)</span></span>
<span id="cb21-3"><a></a><span class="ex">error:</span> linking with <span class="kw">`</span><span class="fu">cc</span><span class="kw">`</span> failed: exit status: 1</span>
<span id="cb21-4"><a></a>  <span class="kw">|</span></span>
<span id="cb21-5"><a></a>  <span class="ex">=</span> note:  <span class="st">"cc"</span> <span class="st">"-m64"</span> <span class="st">"/tmp/rustcheyGtM/symbols.o"</span> <span class="st">"&lt;1 object files omitted&gt;"</span> <span class="st">"-Wl,--as-needed"</span> <span class="st">"-Wl,-Bstatic"</span> <span class="st">"&lt;sysroot&gt;/lib/rustlib/x86_64-unknown-linux-gnu/lib/{librustc_std_workspace_core-*,libcore-*,libcompiler_builtins-*}.rlib"</span> <span class="st">"-L"</span> <span class="st">"/tmp/rustcheyGtM/raw-dylibs"</span> <span class="st">"-Wl,-Bdynamic"</span> <span class="st">"-Wl,--eh-frame-hdr"</span> <span class="st">"-Wl,-z,noexecstack"</span> <span class="st">"-L"</span> <span class="st">"&lt;sysroot&gt;/lib/rustlib/x86_64-unknown-linux-gnu/lib"</span> <span class="st">"-o"</span> <span class="st">"/home/user/tmp/32/target/debug/deps/osirs-80f8eb3240ba748e"</span> <span class="st">"-Wl,--gc-sections"</span> <span class="st">"-pie"</span> <span class="st">"-Wl,-z,relro,-z,now"</span> <span class="st">"-nodefaultlibs"</span></span>
<span id="cb21-6"><a></a>  <span class="ex">=</span> note: some arguments are omitted. use <span class="kw">`</span><span class="ex">--verbose</span><span class="kw">`</span> to show all linker arguments</span>
<span id="cb21-7"><a></a>  <span class="ex">=</span> note: /usr/bin/ld: /home/user/tmp/32/target/debug/deps/osirs-80f8eb3240ba748e.9chdw59nqscmfe0ef1hrxy2nb.rcgu.o: in function <span class="kw">`</span><span class="ex">_start</span><span class="st">':</span></span>
<span id="cb21-8"><a></a><span class="st">          /home/user/tmp/32/src/main.rs:14: multiple definition of `_start'</span><span class="kw">;</span> <span class="ex">/usr/lib/gcc/x86_64-linux-gnu/11/../../../x86_64-linux-gnu/Scrt1.o:</span><span class="er">(</span><span class="ex">.text+0x0</span><span class="kw">)</span><span class="bu">:</span> first defined here</span>
<span id="cb21-9"><a></a>          <span class="ex">/usr/bin/ld:</span> /usr/lib/gcc/x86_64-linux-gnu/11/../../../x86_64-linux-gnu/Scrt1.o: in function <span class="kw">`</span>_start<span class="st">':</span></span>
<span id="cb21-10"><a></a><span class="st">          (.text+0x1b): undefined reference to `main'</span></span>
<span id="cb21-11"><a></a>          <span class="ex">/usr/bin/ld:</span> <span class="er">(</span><span class="ex">.text+0x21</span><span class="kw">)</span><span class="bu">:</span> undefined reference to <span class="kw">`</span><span class="ex">__libc_start_main</span><span class="st">'</span></span>
<span id="cb21-12"><a></a><span class="st">          collect2: error: ld returned 1 exit status</span></span>
<span id="cb21-13"><a></a></span>
<span id="cb21-14"><a></a><span class="st">  = note: some `extern` functions couldn'</span><span class="ex">t</span> be found<span class="kw">;</span> <span class="ex">some</span> native libraries may need to be installed or have their path specified</span>
<span id="cb21-15"><a></a>  <span class="ex">=</span> note: use the <span class="kw">`</span><span class="at">-l</span><span class="kw">`</span> <span class="ex">flag</span> to specify native libraries to link</span>
<span id="cb21-16"><a></a>  <span class="ex">=</span> note: use the <span class="kw">`</span>cargo:rustc-link-lib<span class="kw">`</span> <span class="ex">directive</span> to specify the native libraries to link with Cargo <span class="er">(</span><span class="ex">see</span> https://doc.rust-lang.org/cargo/reference/build-scripts.html#rustc-link-lib<span class="kw">)</span></span>
<span id="cb21-17"><a></a></span>
<span id="cb21-18"><a></a><span class="ex">error:</span> could not compile <span class="kw">`</span>osirs<span class="kw">`</span> <span class="kw">(</span><span class="ex">bin</span> <span class="st">"osirs"</span><span class="kw">)</span> <span class="ex">due</span> to 1 previous error</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="to-be-continued" class="slide level2">
<h2>To be continued</h2>
<ul>
<li>I am 99% sure we run out of time here‚Ä¶</li>
<li>And will continue with the lab on linker errors!</li>
</ul>
<!--

## Linker Errors

- The linker is a program that combines the generated code into an executable. 
- Since the executable format differs between Linux, Windows, and macOS, each system has its own linker that throws a different error. 
- The fundamental cause of the errors is the same: the default configuration of the linker assumes that our program depends on the C runtime, which it does not.

## Solution

- To solve the errors, we need to tell the linker that it should not include the C runtime. 
- We can do this either by passing a certain set of arguments to the linker or by building for a bare metal target.

### Building for a Bare Metal Target

By default Rust tries to build an executable that is able to run in your current system environment. For example, if you're using Windows on `x86_64`, Rust tries to build an `.exe` Windows executable that uses `x86_64` instructions. This environment is called your "host" system.

To describe different environments, Rust uses a string called [_target triple_]. You can see the target triple for your host system by running `rustc --version --verbose`:

[_target triple_]: https://clang.llvm.org/docs/CrossCompilation.html#target-triple

```
rustc 1.35.0-nightly (474e7a648 2019-04-07)
binary: rustc
commit-hash: 474e7a6486758ea6fc761893b1a49cd9076fb0ab
commit-date: 2019-04-07
host: x86_64-unknown-linux-gnu
release: 1.35.0-nightly
LLVM version: 8.0
```

The above output is from a `x86_64` Linux system. We see that the `host` triple is `x86_64-unknown-linux-gnu`, which includes the CPU architecture (`x86_64`), the vendor (`unknown`), the operating system (`linux`), and the [ABI] (`gnu`).

[ABI]: https://en.wikipedia.org/wiki/Application_binary_interface

By compiling for our host triple, the Rust compiler and the linker assume that there is an underlying operating system such as Linux or Windows that uses the C runtime by default, which causes the linker errors. So, to avoid the linker errors, we can compile for a different environment with no underlying operating system.

An example of such a bare metal environment is the `thumbv7em-none-eabihf` target triple, which describes an [embedded] [ARM] system. The details are not important, all that matters is that the target triple has no underlying operating system, which is indicated by the `none` in the target triple. To be able to compile for this target, we need to add it in rustup:

[embedded]: https://en.wikipedia.org/wiki/Embedded_system
[ARM]: https://en.wikipedia.org/wiki/ARM_architecture

```
rustup target add thumbv7em-none-eabihf
```

This downloads a copy of the standard (and core) library for the system. Now we can build our freestanding executable for this target:

```
cargo build --target thumbv7em-none-eabihf
```

By passing a `--target` argument we [cross compile] our executable for a bare metal target system. Since the target system has no operating system, the linker does not try to link the C runtime and our build succeeds without any linker errors.

[cross compile]: https://en.wikipedia.org/wiki/Cross_compiler

This is the approach that we will use for building our OS kernel. Instead of `thumbv7em-none-eabihf`, we will use a [custom target] that describes a `x86_64` bare metal environment. The details will be explained in the next post.

[custom target]: https://doc.rust-lang.org/rustc/targets/custom.html

### Linker Arguments

Instead of compiling for a bare metal system, it is also possible to resolve the linker errors by passing a certain set of arguments to the linker. This will be the subject of the lab this week.


## Summary

A minimal freestanding Rust binary looks like this:

`src/main.rs`:

```rust
#![no_std] // don't link the Rust standard library
#![no_main] // disable all Rust-level entry points

#[unsafe(no_mangle)] // don't mangle the name of this function
pub extern "C" fn _start() -> ! {
    // this function is the entry point, since the linker looks for a function
    // named `_start` by default
    loop {}
}

/// This function is called on panic.
#[panic_handler]
fn panic(_info: &core::panic::PanicInfo) -> ! {
    loop {}
}
```

`Cargo.toml`:

```toml
[package]
name = "crate_name"
version = "0.1.0"
authors = ["Author Name <author@example.com>"]

# the profile used for `cargo build`
[profile.dev]
panic = "abort" # disable stack unwinding on panic

# the profile used for `cargo build --release`
[profile.release]
panic = "abort" # disable stack unwinding on panic
```

To build this binary, we need to compile for a bare metal target such as `thumbv7em-none-eabihf`:

```
cargo build --target thumbv7em-none-eabihf
```

Alternatively, we can compile it for the host system by passing additional linker arguments:

```bash
# Linux
cargo rustc -- -C link-arg=-nostartfiles
# Windows
cargo rustc -- -C link-args="/ENTRY:_start /SUBSYSTEM:console"
# macOS
cargo rustc -- -C link-args="-e __start -static -nostartfiles"
```

Note that this is just a minimal example of a freestanding Rust binary. This binary expects various things, for example, that a stack is initialized when the `_start` function is called. **So for any real use of such a binary, more steps are required**.

## Making `rust-analyzer` happy

The [`rust-analyzer`](https://rust-analyzer.github.io/) project is a great way to get code completion and "go to definition" support (and many other features) for Rust code in your editor.
It works really well for `#![no_std]` projects too, so I recommend using it for kernel development!

If you're using the [`checkOnSave`](https://rust-analyzer.github.io/book/configuration.html#checkOnSave) feature of `rust-analyzer` (enabled by default), it might report an error for the panic function of our kernel:

```
found duplicate lang item `panic_impl`
```

The reason for this error is that `rust-analyzer` invokes `cargo check --all-targets` by default, which also tries to build the binary in [test](https://doc.rust-lang.org/book/ch11-01-writing-tests.html) and [benchmark](https://doc.rust-lang.org/rustc/tests/index.html#benchmarks) mode.

<div class="note">

### The two meanings of "target"

The `--all-targets` flag is completely unrelated to the `--target` argument.
There are two different meanings of the term "target" in `cargo`:

- The `--target` flag specifies the **[_compilation target_]** that should be passed to the `rustc` compiler. This should be set to the [target triple] of the machine that should run our code.
- The `--all-targets` flag references the **[_package target_]** of Cargo. Cargo packages can be a library and binary at the same time, so you can specify in which way you like to build your crate. In addition, Cargo also has package targets for [examples](https://doc.rust-lang.org/cargo/reference/cargo-targets.html#examples), [tests](https://doc.rust-lang.org/cargo/reference/cargo-targets.html#tests), and [benchmarks](https://doc.rust-lang.org/cargo/reference/cargo-targets.html#benchmarks). These package targets can co-exist, so you can build/check the same crate in e.g. library or test mode.

[_compilation target_]: https://doc.rust-lang.org/rustc/targets/index.html
[target triple]: https://clang.llvm.org/docs/CrossCompilation.html#target-triple
[_package target_]: https://doc.rust-lang.org/cargo/reference/cargo-targets.html

</div>

By default, `cargo check` only builds the _library_ and _binary_ package targets.
However, `rust-analyzer` chooses to check all package targets by default when [`checkOnSave`](https://rust-analyzer.github.io/book/configuration.html#checkOnSave) is enabled.
This is the reason that `rust-analyzer` reports the above `lang item` error that we don't see in `cargo check`.
If we run `cargo check --all-targets`, we see the error too:

```
error[E0152]: found duplicate lang item `panic_impl`
  -->
<p>src/main.rs:13:1 | 13 | / fn panic(<em>info: &amp;PanicInfo) -&gt; ! { 14 | | loop {} 15 | | } | |</em>^ | = note: the lang item is first defined in crate <code>std</code> (which <code>test</code> depends on) = note: first definition in <code>std</code> loaded from /home/[‚Ä¶]/.rustup/toolchains/stable-x86_64-unknown-linux-gnu/lib/rustlib/x86_64-unknown-linux-gnu/lib/libstd-8df6be531efb3fd0.rlib = note: second definition in the local crate (<code>blog_os</code>)</p>
<pre><code>
The first `note` tells us that the panic language item is already defined in the `std` crate, which is a dependency of the `test` crate.
The `test` crate is automatically included when building a crate in [test mode](https://doc.rust-lang.org/cargo/reference/cargo-targets.html#tests).
This does not make sense for our `#![no_std]` kernel as there is no way to support the standard library on bare metal.
So this error is not relevant to our project and we can safely ignore it.

The proper way to avoid this error is to specify in our `Cargo.toml` that our binary does not support building in `test` and `bench` modes.
We can do that by adding a `[[bin]]` section to our `Cargo.toml` to [configure the build](https://doc.rust-lang.org/cargo/reference/cargo-targets.html#configuring-a-target) of our binary:

```toml
# in Cargo.toml

[[bin]]
name = "blog_os"
test = false
bench = false</code></pre>
<p>The double-brackets around <code>bin</code> are not a mistake, this is how the TOML format defines keys that can appear multiple times. Since a crate can have multiple binaries, the <code>[[bin]]</code> section can appear multiple times in the <code>Cargo.toml</code> as well. This is also the reason for the mandatory <code>name</code> field, which needs to match the name of the binary (so that <code>cargo</code> knows which settings should be applied to which binary).</p>
<p>By setting the <a href="https://doc.rust-lang.org/cargo/reference/cargo-targets.html#the-test-field"><code>test</code></a> and <a href="https://doc.rust-lang.org/cargo/reference/cargo-targets.html#the-bench-field"><code>bench</code></a> fields to <code>false</code>, we instruct <code>cargo</code> to not build our binary in test or benchmark mode. Now <code>cargo check --all-targets</code> should not throw any errors anymore, and the <code>checkOnSave</code> implementation of <code>rust-analyzer</code> should be happy too.</p>
<p>‚Äì&gt;</p>


</section></section>
    </div>
  <div class="quarto-auto-generated-content" style="display: none;">
<div class="footer footer-default">
<p><a href="index.html">Home</a></p>
</div>
</div></div>

  <script>window.backupDefine = window.define; window.define = undefined;</script>
  <script src="site_libs/revealjs/dist/reveal.js"></script>
  <!-- reveal.js plugins -->
  <script src="site_libs/revealjs/plugin/quarto-line-highlight/line-highlight.js"></script>
  <script src="site_libs/revealjs/plugin/pdf-export/pdfexport.js"></script>
  <script src="site_libs/revealjs/plugin/reveal-menu/menu.js"></script>
  <script src="site_libs/revealjs/plugin/reveal-menu/quarto-menu.js"></script>
  <script src="site_libs/revealjs/plugin/quarto-support/support.js"></script>
  

  <script src="site_libs/revealjs/plugin/notes/notes.js"></script>
  <script src="site_libs/revealjs/plugin/search/search.js"></script>
  <script src="site_libs/revealjs/plugin/zoom/zoom.js"></script>
  <script src="site_libs/revealjs/plugin/math/math.js"></script>
  <script>window.define = window.backupDefine; window.backupDefine = undefined;</script>

  <script>

      // Full list of configuration options available at:
      // https://revealjs.com/config/
      Reveal.initialize({
'controlsAuto': true,
'previewLinksAuto': false,
'pdfSeparateFragments': false,
'autoAnimateEasing': "ease",
'autoAnimateDuration': 1,
'autoAnimateUnmatched': true,
'jumpToSlide': true,
'menu': {"side":"left","useTextContentForMissingTitles":true,"markers":false,"loadIcons":false,"custom":[{"title":"Tools","icon":"<i class=\"fas fa-gear\"></i>","content":"<ul class=\"slide-menu-items\">\n<li class=\"slide-tool-item active\" data-item=\"0\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.fullscreen(event)\"><kbd>f</kbd> Fullscreen</a></li>\n<li class=\"slide-tool-item\" data-item=\"1\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.speakerMode(event)\"><kbd>s</kbd> Speaker View</a></li>\n<li class=\"slide-tool-item\" data-item=\"2\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.overview(event)\"><kbd>o</kbd> Slide Overview</a></li>\n<li class=\"slide-tool-item\" data-item=\"3\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.togglePdfExport(event)\"><kbd>e</kbd> PDF Export Mode</a></li>\n<li class=\"slide-tool-item\" data-item=\"4\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.toggleScrollView(event)\"><kbd>r</kbd> Scroll View Mode</a></li>\n<li class=\"slide-tool-item\" data-item=\"5\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.keyboardHelp(event)\"><kbd>?</kbd> Keyboard Help</a></li>\n</ul>"}],"openButton":true},
'smaller': false,
 
        // Display controls in the bottom right corner
        controls: false,

        // Help the user learn the controls by providing hints, for example by
        // bouncing the down arrow when they first encounter a vertical slide
        controlsTutorial: false,

        // Determines where controls appear, "edges" or "bottom-right"
        controlsLayout: 'edges',

        // Visibility rule for backwards navigation arrows; "faded", "hidden"
        // or "visible"
        controlsBackArrows: 'faded',

        // Display a presentation progress bar
        progress: true,

        // Display the page number of the current slide
        slideNumber: 'c/t',

        // 'all', 'print', or 'speaker'
        showSlideNumber: 'all',

        // Add the current slide number to the URL hash so that reloading the
        // page/copying the URL will return you to the same slide
        hash: true,

        // Start with 1 for the hash rather than 0
        hashOneBasedIndex: false,

        // Flags if we should monitor the hash and change slides accordingly
        respondToHashChanges: true,

        // Push each slide change to the browser history
        history: true,

        // Enable keyboard shortcuts for navigation
        keyboard: true,

        // Enable the slide overview mode
        overview: true,

        // Disables the default reveal.js slide layout (scaling and centering)
        // so that you can use custom CSS layout
        disableLayout: false,

        // Vertical centering of slides
        center: false,

        // Enables touch navigation on devices with touch input
        touch: true,

        // Loop the presentation
        loop: false,

        // Change the presentation direction to be RTL
        rtl: false,

        // see https://revealjs.com/vertical-slides/#navigation-mode
        navigationMode: 'linear',

        // Randomizes the order of slides each time the presentation loads
        shuffle: false,

        // Turns fragments on and off globally
        fragments: true,

        // Flags whether to include the current fragment in the URL,
        // so that reloading brings you to the same fragment position
        fragmentInURL: false,

        // Flags if the presentation is running in an embedded mode,
        // i.e. contained within a limited portion of the screen
        embedded: false,

        // Flags if we should show a help overlay when the questionmark
        // key is pressed
        help: true,

        // Flags if it should be possible to pause the presentation (blackout)
        pause: true,

        // Flags if speaker notes should be visible to all viewers
        showNotes: false,

        // Global override for autoplaying embedded media (null/true/false)
        autoPlayMedia: null,

        // Global override for preloading lazy-loaded iframes (null/true/false)
        preloadIframes: null,

        // Number of milliseconds between automatically proceeding to the
        // next slide, disabled when set to 0, this value can be overwritten
        // by using a data-autoslide attribute on your slides
        autoSlide: 0,

        // Stop auto-sliding after user input
        autoSlideStoppable: true,

        // Use this method for navigation when auto-sliding
        autoSlideMethod: null,

        // Specify the average time in seconds that you think you will spend
        // presenting each slide. This is used to show a pacing timer in the
        // speaker view
        defaultTiming: null,

        // Enable slide navigation via mouse wheel
        mouseWheel: false,

        // The display mode that will be used to show slides
        display: 'block',

        // Hide cursor if inactive
        hideInactiveCursor: true,

        // Time before the cursor is hidden (in ms)
        hideCursorTime: 5000,

        // Opens links in an iframe preview overlay
        previewLinks: false,

        // Transition style (none/fade/slide/convex/concave/zoom)
        transition: 'none',

        // Transition speed (default/fast/slow)
        transitionSpeed: 'default',

        // Transition style for full page slide backgrounds
        // (none/fade/slide/convex/concave/zoom)
        backgroundTransition: 'none',

        // Number of slides away from the current that are visible
        viewDistance: 3,

        // Number of slides away from the current that are visible on mobile
        // devices. It is advisable to set this to a lower number than
        // viewDistance in order to save resources.
        mobileViewDistance: 2,

        // The "normal" size of the presentation, aspect ratio will be preserved
        // when the presentation is scaled to fit different resolutions. Can be
        // specified using percentage units.
        width: 1050,

        height: 700,

        // Factor of the display size that should remain empty around the content
        margin: 0.1,

        math: {
          mathjax: 'https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/MathJax.js',
          config: 'TeX-AMS_HTML-full',
          tex2jax: {
            inlineMath: [['\\(','\\)']],
            displayMath: [['\\[','\\]']],
            balanceBraces: true,
            processEscapes: false,
            processRefs: true,
            processEnvironments: true,
            preview: 'TeX',
            skipTags: ['script','noscript','style','textarea','pre','code'],
            ignoreClass: 'tex2jax_ignore',
            processClass: 'tex2jax_process'
          },
        },

        // reveal.js plugins
        plugins: [QuartoLineHighlight, PdfExport, RevealMenu, QuartoSupport,

          RevealMath,
          RevealNotes,
          RevealSearch,
          RevealZoom
        ]
      });
    </script>
    <script id="quarto-html-after-body" type="application/javascript">
    window.document.addEventListener("DOMContentLoaded", function (event) {
      const toggleBodyColorMode = (bsSheetEl) => {
        const mode = bsSheetEl.getAttribute("data-mode");
        const bodyEl = window.document.querySelector("body");
        if (mode === "dark") {
          bodyEl.classList.add("quarto-dark");
          bodyEl.classList.remove("quarto-light");
        } else {
          bodyEl.classList.add("quarto-light");
          bodyEl.classList.remove("quarto-dark");
        }
      }
      const toggleBodyColorPrimary = () => {
        const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
        if (bsSheetEl) {
          toggleBodyColorMode(bsSheetEl);
        }
      }
      toggleBodyColorPrimary();  
      const tabsets =  window.document.querySelectorAll(".panel-tabset-tabby")
      tabsets.forEach(function(tabset) {
        const tabby = new Tabby('#' + tabset.id);
      });
      const isCodeAnnotation = (el) => {
        for (const clz of el.classList) {
          if (clz.startsWith('code-annotation-')) {                     
            return true;
          }
        }
        return false;
      }
      const onCopySuccess = function(e) {
        // button target
        const button = e.trigger;
        // don't keep focus
        button.blur();
        // flash "checked"
        button.classList.add('code-copy-button-checked');
        var currentTitle = button.getAttribute("title");
        button.setAttribute("title", "Copied!");
        let tooltip;
        if (window.bootstrap) {
          button.setAttribute("data-bs-toggle", "tooltip");
          button.setAttribute("data-bs-placement", "left");
          button.setAttribute("data-bs-title", "Copied!");
          tooltip = new bootstrap.Tooltip(button, 
            { trigger: "manual", 
              customClass: "code-copy-button-tooltip",
              offset: [0, -8]});
          tooltip.show();    
        }
        setTimeout(function() {
          if (tooltip) {
            tooltip.hide();
            button.removeAttribute("data-bs-title");
            button.removeAttribute("data-bs-toggle");
            button.removeAttribute("data-bs-placement");
          }
          button.setAttribute("title", currentTitle);
          button.classList.remove('code-copy-button-checked');
        }, 1000);
        // clear code selection
        e.clearSelection();
      }
      const getTextToCopy = function(trigger) {
          const codeEl = trigger.previousElementSibling.cloneNode(true);
          for (const childEl of codeEl.children) {
            if (isCodeAnnotation(childEl)) {
              childEl.remove();
            }
          }
          return codeEl.innerText;
      }
      const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
        text: getTextToCopy
      });
      clipboard.on('success', onCopySuccess);
      if (window.document.getElementById('quarto-embedded-source-code-modal')) {
        // For code content inside modals, clipBoardJS needs to be initialized with a container option
        // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
        const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
          text: getTextToCopy,
          container: window.document.getElementById('quarto-embedded-source-code-modal')
        });
        clipboardModal.on('success', onCopySuccess);
      }
        var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
        var mailtoRegex = new RegExp(/^mailto:/);
          var filterRegex = new RegExp('/' + window.location.host + '/');
        var isInternal = (href) => {
            return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
        }
        // Inspect non-navigation links and adorn them if external
     	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
        for (var i=0; i<links.length; i++) {
          const link = links[i];
          if (!isInternal(link.href)) {
            // undo the damage that might have been done by quarto-nav.js in the case of
            // links that we want to consider external
            if (link.dataset.originalHref !== undefined) {
              link.href = link.dataset.originalHref;
            }
          }
        }
      function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
        const config = {
          allowHTML: true,
          maxWidth: 500,
          delay: 100,
          arrow: false,
          appendTo: function(el) {
              return el.closest('section.slide') || el.parentElement;
          },
          interactive: true,
          interactiveBorder: 10,
          theme: 'light-border',
          placement: 'bottom-start',
        };
        if (contentFn) {
          config.content = contentFn;
        }
        if (onTriggerFn) {
          config.onTrigger = onTriggerFn;
        }
        if (onUntriggerFn) {
          config.onUntrigger = onUntriggerFn;
        }
          config['offset'] = [0,0];
          config['maxWidth'] = 700;
        window.tippy(el, config); 
      }
      const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
      for (var i=0; i<noterefs.length; i++) {
        const ref = noterefs[i];
        tippyHover(ref, function() {
          // use id or data attribute instead here
          let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
          try { href = new URL(href).hash; } catch {}
          const id = href.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note) {
            return note.innerHTML;
          } else {
            return "";
          }
        });
      }
      const findCites = (el) => {
        const parentEl = el.parentElement;
        if (parentEl) {
          const cites = parentEl.dataset.cites;
          if (cites) {
            return {
              el,
              cites: cites.split(' ')
            };
          } else {
            return findCites(el.parentElement)
          }
        } else {
          return undefined;
        }
      };
      var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
      for (var i=0; i<bibliorefs.length; i++) {
        const ref = bibliorefs[i];
        const citeInfo = findCites(ref);
        if (citeInfo) {
          tippyHover(citeInfo.el, function() {
            var popup = window.document.createElement('div');
            citeInfo.cites.forEach(function(cite) {
              var citeDiv = window.document.createElement('div');
              citeDiv.classList.add('hanging-indent');
              citeDiv.classList.add('csl-entry');
              var biblioDiv = window.document.getElementById('ref-' + cite);
              if (biblioDiv) {
                citeDiv.innerHTML = biblioDiv.innerHTML;
              }
              popup.appendChild(citeDiv);
            });
            return popup.innerHTML;
          });
        }
      }
    });
    </script>
    

</body></html>